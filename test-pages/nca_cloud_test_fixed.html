<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>No-Code Architects Toolkit - é›²ç«¯æ¸¬è©¦ä¸­å¿ƒ (ä¿®å¾©ç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/static/js/jquery-3.6.0.min.js"></script>
    <style>
        .response-container {
            max-height: 300px;
            overflow-y: auto;
        }
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">ğŸ¬ No-Code Architects Toolkit</h1>
            <p class="text-gray-600">é›²ç«¯æ¸¬è©¦ä»‹é¢ - ä½¿ç”¨æœ¬åœ°æˆåŠŸçš„APIç«¯é»</p>
            <div class="mt-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">API åŸºç¤åœ°å€:</label>
                <input type="text" id="baseUrl" value="https://vidsparkback.zeabur.app" 
                       class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500">
            </div>
            <div class="mt-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">API Key:</label>
                <input type="text" id="apiKey" value="vidspark-production-api-key-2024-secure" 
                       class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500">
            </div>
        </div>

        <!-- Upload Section -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">ğŸ“ æœ¬åœ°æ–‡ä»¶ä¸Šå‚³</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- éŸ³é »ä¸Šå‚³ -->
                <div class="border border-gray-200 rounded-lg p-4">
                    <h3 class="font-medium mb-3">ğŸ§ éŸ³é »ä¸Šå‚³</h3>
                    <input type="file" id="audioFile" accept=".mp3,.wav,.m4a,.flac" 
                           class="w-full p-2 border border-gray-300 rounded-md mb-3">
                    <button onclick="uploadAudioFile()" 
                            class="w-full bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                        ä¸Šå‚³éŸ³é »æ–‡ä»¶
                    </button>
                    <div id="audioUploadResult" class="mt-3"></div>
                </div>
                
                <!-- è¦–é »ä¸Šå‚³ -->
                <div class="border border-gray-200 rounded-lg p-4">
                    <h3 class="font-medium mb-3">ğŸ¥ è¦–é »ä¸Šå‚³</h3>
                    <input type="file" id="videoFile" accept=".mp4,.avi,.mov,.mkv" 
                           class="w-full p-2 border border-gray-300 rounded-md mb-3">
                    <button onclick="uploadVideoFile()" 
                            class="w-full bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded">
                        ä¸Šå‚³è¦–é »æ–‡ä»¶
                    </button>
                    <div id="videoUploadResult" class="mt-3"></div>
                </div>
            </div>
            
            <!-- ä¸Šå‚³æ­·å² -->
            <div class="mt-6">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-medium">ğŸ“‹ ä¸Šå‚³æ­·å²</h3>
                    <button onclick="refreshUploadHistory()" 
                            class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-1 px-3 rounded text-sm">
                        åˆ·æ–°
                    </button>
                </div>
                <div id="uploadHistory" class="border border-gray-200 rounded-lg p-4 max-h-60 overflow-y-auto">
                    <p class="text-gray-500">æ­£åœ¨è¼‰å…¥ä¸Šå‚³æ­·å²...</p>
                </div>
            </div>
        </div>

        <!-- Status Check -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">ğŸ” æœå‹™ç‹€æ…‹æª¢æŸ¥</h2>
            <button onclick="checkStatus()" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mr-2">
                æª¢æŸ¥æœå‹™ç‹€æ…‹
            </button>
            <button onclick="checkHealth()" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded mr-2">
                å¥åº·æª¢æŸ¥
            </button>
            <button onclick="testDatabase()" class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded mr-2">
                æ•¸æ“šåº«æ¸¬è©¦
            </button>
            <button onclick="initDatabase()" class="bg-yellow-500 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded mr-2">
                åˆå§‹åŒ–æ•¸æ“šåº«
            </button>
            <button onclick="getDatabaseStats()" class="bg-indigo-500 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded">
                æ•¸æ“šåº«çµ±è¨ˆ
            </button>
            <div id="statusResult" class="mt-4"></div>
        </div>

        <!-- Tab Navigation -->
        <div class="bg-white rounded-lg shadow-md mb-6">
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-8 px-6">
                    <button onclick="showTab('video')" class="tab-btn active py-4 px-1 border-b-2 border-blue-500 font-medium text-sm text-blue-600">
                        å½±ç‰‡è™•ç†
                    </button>
                    <button onclick="showTab('audio')" class="tab-btn py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700">
                        éŸ³é »è™•ç†
                    </button>
                    <button onclick="showTab('subtitle')" class="tab-btn py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700">
                        å­—å¹•ç”Ÿæˆ
                    </button>
                    <button onclick="showTab('image')" class="tab-btn py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700">
                        åœ–åƒè™•ç†
                    </button>
                </nav>
            </div>

            <!-- Video Tab -->
            <div id="video-tab" class="tab-content p-6">
                <h3 class="text-lg font-semibold mb-4">ğŸ¬ å½±ç‰‡è™•ç†åŠŸèƒ½</h3>
                
                <!-- Video Cut -->
                <div class="border border-gray-200 rounded-lg p-4 mb-4">
                    <h4 class="font-medium mb-3">å½±ç‰‡å‰ªè¼¯ (/v1/video/cut)</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">å½±ç‰‡URL:</label>
                            <input type="url" id="cutVideoUrl" 
                                   placeholder="https://sample-videos.com/zip/10/mp4/SampleVideo_720x480_1mb.mp4"
                                   class="w-full p-2 border border-gray-300 rounded-md text-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">å‰ªè¼¯æ™‚é–“ (é–‹å§‹-çµæŸ):</label>
                            <div class="flex gap-2">
                                <input type="text" id="cutStart" placeholder="00:00:01" class="flex-1 p-2 border border-gray-300 rounded-md text-sm">
                                <input type="text" id="cutEnd" placeholder="00:00:10" class="flex-1 p-2 border border-gray-300 rounded-md text-sm">
                            </div>
                        </div>
                    </div>
                    <button onclick="testVideoCut()" class="mt-3 bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded text-sm">
                        æ¸¬è©¦å½±ç‰‡å‰ªè¼¯
                    </button>
                    <div id="cutResult" class="mt-3"></div>
                </div>

                <!-- Video Trim -->
                <div class="border border-gray-200 rounded-lg p-4 mb-4">
                    <h4 class="font-medium mb-3">å½±ç‰‡ä¿®å‰ª (/v1/video/trim)</h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">å½±ç‰‡URL:</label>
                            <input type="url" id="trimVideoUrl" 
                                   placeholder="https://sample-videos.com/zip/10/mp4/SampleVideo_720x480_1mb.mp4"
                                   class="w-full p-2 border border-gray-300 rounded-md text-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">é–‹å§‹æ™‚é–“:</label>
                            <input type="text" id="trimStart" placeholder="00:00:00" class="w-full p-2 border border-gray-300 rounded-md text-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">çµæŸæ™‚é–“:</label>
                            <input type="text" id="trimEnd" placeholder="00:00:10" class="w-full p-2 border border-gray-300 rounded-md text-sm">
                        </div>
                    </div>
                    <button onclick="testVideoTrim()" class="mt-3 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded text-sm">
                        æ¸¬è©¦å½±ç‰‡ä¿®å‰ª
                    </button>
                    <div id="trimResult" class="mt-3"></div>
                </div>

                <!-- Video Thumbnail -->
                <div class="border border-gray-200 rounded-lg p-4 mb-4">
                    <h4 class="font-medium mb-3">ç¸®åœ–ç”Ÿæˆ (/v1/video/thumbnail)</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">å½±ç‰‡URL:</label>
                            <input type="url" id="thumbnailVideoUrl" 
                                   placeholder="https://sample-videos.com/zip/10/mp4/SampleVideo_720x480_1mb.mp4"
                                   class="w-full p-2 border border-gray-300 rounded-md text-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">æ™‚é–“é» (HH:MM:SS):</label>
                            <input type="text" id="thumbnailTime" placeholder="00:00:05" class="w-full p-2 border border-gray-300 rounded-md text-sm">
                        </div>
                    </div>
                    <button onclick="testVideoThumbnail()" class="mt-3 bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded text-sm">
                        ç”Ÿæˆç¸®åœ–
                    </button>
                    <div id="thumbnailResult" class="mt-3"></div>
                </div>
            </div>

            <!-- Audio Tab -->
            <div id="audio-tab" class="tab-content p-6 hidden">
                <h3 class="text-lg font-semibold mb-4">ğŸµ éŸ³é »è™•ç†åŠŸèƒ½</h3>
                
                <!-- Audio Concatenate -->
                <div class="border border-gray-200 rounded-lg p-4 mb-4">
                    <h4 class="font-medium mb-3">éŸ³é »åˆä½µ (/v1/audio/concatenate)</h4>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">éŸ³é »URLåˆ—è¡¨ (æ¯è¡Œä¸€å€‹):</label>
                        <textarea id="audioUrls" rows="4" 
                                  placeholder="https://example.com/audio1.mp3&#10;https://example.com/audio2.mp3"
                                  class="w-full p-2 border border-gray-300 rounded-md text-sm"></textarea>
                    </div>
                    <button onclick="testAudioConcatenate()" class="mt-3 bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded text-sm">
                        æ¸¬è©¦éŸ³é »åˆä½µ
                    </button>
                    <div id="audioResult" class="mt-3"></div>
                </div>
            </div>

            <!-- Subtitle Tab -->
            <div id="subtitle-tab" class="tab-content p-6 hidden">
                <h3 class="text-lg font-semibold mb-4">ğŸ“ å­—å¹•ç”ŸæˆåŠŸèƒ½</h3>
                
                <!-- Media Transcribe -->
                <div class="border border-gray-200 rounded-lg p-4 mb-4">
                    <h4 class="font-medium mb-3">éŸ³é »è½‰éŒ„ (/v1/media/transcribe)</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">åª’é«”URL:</label>
                            <input type="url" id="transcribeUrl" 
                                   placeholder="https://example.com/audio.mp3"
                                   class="w-full p-2 border border-gray-300 rounded-md text-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">èªè¨€:</label>
                            <select id="transcribeLanguage" class="w-full p-2 border border-gray-300 rounded-md text-sm">
                                <option value="">è‡ªå‹•æª¢æ¸¬</option>
                                <option value="zh">ä¸­æ–‡</option>
                                <option value="en">è‹±æ–‡</option>
                                <option value="ja">æ—¥æ–‡</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-2 mt-3">
                        <label class="flex items-center">
                            <input type="checkbox" id="includeText" checked class="mr-2"> åŒ…å«æ–‡æœ¬
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="includeSrt" checked class="mr-2"> åŒ…å«SRT
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="includeSegments" class="mr-2"> åŒ…å«ç‰‡æ®µ
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="wordTimestamps" class="mr-2"> è©ç´šæ™‚é–“æˆ³
                        </label>
                    </div>
                    <button onclick="testTranscribe()" class="mt-3 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded text-sm">
                        æ¸¬è©¦éŸ³é »è½‰éŒ„
                    </button>
                    <div id="transcribeResult" class="mt-3"></div>
                </div>

                <!-- Video Caption -->
                <div class="border border-gray-200 rounded-lg p-4 mb-4">
                    <h4 class="font-medium mb-3">å½±ç‰‡å­—å¹• (/v1/video/caption)</h4>
                    <div class="grid grid-cols-1 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">å½±ç‰‡URL:</label>
                            <input type="url" id="captionVideoUrl" 
                                   placeholder="https://sample-videos.com/zip/10/mp4/SampleVideo_720x480_1mb.mp4"
                                   class="w-full p-2 border border-gray-300 rounded-md text-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">å­—å¹•æ–‡æœ¬ (å¯é¸ï¼Œç•™ç©ºè‡ªå‹•ç”Ÿæˆ):</label>
                            <textarea id="captionText" rows="3" 
                                      placeholder="å¯é¸ï¼šæ‰‹å‹•è¼¸å…¥å­—å¹•æ–‡æœ¬"
                                      class="w-full p-2 border border-gray-300 rounded-md text-sm"></textarea>
                        </div>
                    </div>
                    <button onclick="testVideoCaption()" class="mt-3 bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded text-sm">
                        ç”Ÿæˆå½±ç‰‡å­—å¹•
                    </button>
                    <div id="captionResult" class="mt-3"></div>
                </div>
            </div>

            <!-- Image Tab -->
            <div id="image-tab" class="tab-content p-6 hidden">
                <h3 class="text-lg font-semibold mb-4">ğŸ–¼ï¸ åœ–åƒè™•ç†åŠŸèƒ½</h3>
                
                <!-- Image to Video -->
                <div class="border border-gray-200 rounded-lg p-4 mb-4">
                    <h4 class="font-medium mb-3">åœ–ç‰‡è½‰å½±ç‰‡ (/v1/image/convert/video)</h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">åœ–ç‰‡URL:</label>
                            <input type="url" id="imageVideoUrl" 
                                   placeholder="https://example.com/image.jpg"
                                   class="w-full p-2 border border-gray-300 rounded-md text-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">å½±ç‰‡é•·åº¦ (ç§’):</label>
                            <input type="number" id="videoDuration" value="5" min="1" max="30" 
                                   class="w-full p-2 border border-gray-300 rounded-md text-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ç¸®æ”¾æ•ˆæœ:</label>
                            <select id="zoomEffect" class="w-full p-2 border border-gray-300 rounded-md text-sm">
                                <option value="none">ç„¡</option>
                                <option value="slow">æ…¢é€Ÿç¸®æ”¾</option>
                                <option value="medium">ä¸­é€Ÿç¸®æ”¾</option>
                                <option value="fast">å¿«é€Ÿç¸®æ”¾</option>
                            </select>
                        </div>
                    </div>
                    <button onclick="testImageToVideo()" class="mt-3 bg-indigo-500 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded text-sm">
                        ç”Ÿæˆå½±ç‰‡
                    </button>
                    <div id="imageVideoResult" class="mt-3"></div>
                </div>
            </div>
        </div>

        <!-- Job Status Check -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">ğŸ“Š ä»»å‹™ç‹€æ…‹æŸ¥è©¢</h2>
            <div class="flex gap-4">
                <input type="text" id="jobId" placeholder="è¼¸å…¥ä»»å‹™ID" 
                       class="flex-1 p-2 border border-gray-300 rounded-md">
                <button onclick="checkJobStatus()" class="bg-indigo-500 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded">
                    æŸ¥è©¢ç‹€æ…‹
                </button>
            </div>
            <div id="jobStatusResult" class="mt-4"></div>
        </div>
    </div>

    <script>
        // APIèª¿ç”¨åŸºç¤å‡½æ•¸ - å¢å¼·ç‰ˆæ§åˆ¶å°æ—¥èªŒ
        function makeApiCall(endpoint, method = 'GET', data = null) {
            const baseUrl = $('#baseUrl').val();
            const apiKey = $('#apiKey').val();
            const startTime = Date.now();
            const currentTime = new Date().toLocaleTimeString();
            
            // ğŸš¨ è©³ç´°æ§åˆ¶å°æ—¥èªŒ - APIèª¿ç”¨é–‹å§‹
            console.log(`[${currentTime}] ğŸš€ APIèª¿ç”¨: ${method} ${baseUrl}${endpoint}`);
            console.log(`[${currentTime}] ğŸ“Š æ•¸æ“š:`, data);
            console.log(`[${currentTime}] ğŸ”‘ API Key:`, apiKey ? 'å·²è¨­ç½®' : 'æœªè¨­ç½®');
            
            const config = {
                url: baseUrl + endpoint,
                method: method,
                headers: {
                    'x-api-key': apiKey,
                    'Content-Type': 'application/json'
                },
                timeout: 120000,
                success: function(response) {
                    const endTime = Date.now();
                    const responseTime = endTime - startTime;
                    const endTimeStr = new Date().toLocaleTimeString();
                    
                    console.log(`[${endTimeStr}] âœ… APIèª¿ç”¨æˆåŠŸ (${responseTime}ms):`);
                    console.log(`[${endTimeStr}] ğŸ“Š éŸ¿æ‡‰å¤§å°:`, JSON.stringify(response).length, 'å­—ç¬¦');
                    console.log(`[${endTimeStr}] ğŸ“Š éŸ¿æ‡‰å…§å®¹:`, response);
                    
                    // å¦‚æœæ˜¯æ–‡ä»¶ç›¸é—œéŸ¿æ‡‰ï¼Œé¡å¤–è¨˜éŒ„æ–‡ä»¶ä¿¡æ¯
                    if (response && response.file_url) {
                        console.log(`[${endTimeStr}] ğŸ“ æ–‡ä»¶URL:`, response.file_url);
                        console.log(`[${endTimeStr}] ğŸ“¦ æ–‡ä»¶å¤§å°:`, response.file_size || 'æœªçŸ¥');
                        // æ¸¬è©¦æ–‡ä»¶URLå¯è¨ªå•æ€§
                        testFileAccess(response.file_url);
                    }
                },
                error: function(xhr, status, error) {
                    const endTime = Date.now();
                    const responseTime = endTime - startTime;
                    const endTimeStr = new Date().toLocaleTimeString();
                    
                    console.log(`[${endTimeStr}] âŒ APIèª¿ç”¨å¤±æ•— (${responseTime}ms):`);
                    console.log(`[${endTimeStr}] ğŸ“Š HTTPç‹€æ…‹:`, xhr.status);
                    console.log(`[${endTimeStr}] ğŸ“Š éŒ¯èª¤é¡å‹:`, status);
                    console.log(`[${endTimeStr}] ğŸ“Š éŒ¯èª¤è©³æƒ…:`, error);
                    console.log(`[${endTimeStr}] ğŸ“Š éŸ¿æ‡‰é ­:`, xhr.getAllResponseHeaders());
                    console.log(`[${endTimeStr}] ğŸ“Š éŸ¿æ‡‰æ–‡æœ¬:`, xhr.responseText);
                }
            };
            
            if (data) {
                config.data = JSON.stringify(data);
                console.log(`[${currentTime}] ğŸ“¤ ç™¼é€æ•¸æ“šå¤§å°:`, JSON.stringify(data).length, 'å­—ç¬¦');
            }
            
            return $.ajax(config);
        }
        
        // æ¸¬è©¦æ–‡ä»¶URLå¯è¨ªå•æ€§
        function testFileAccess(fileUrl) {
            const testTime = new Date().toLocaleTimeString();
            console.log(`[${testTime}] ğŸ” æ¸¬è©¦æ–‡ä»¶å¯è¨ªå•æ€§:`, fileUrl);
            
            fetch(fileUrl, { method: 'HEAD' })
                .then(response => {
                    console.log(`[${testTime}] âœ… æ–‡ä»¶å¯è¨ªå•:`, response.status, response.statusText);
                    console.log(`[${testTime}] ğŸ“Š Content-Type:`, response.headers.get('Content-Type'));
                    console.log(`[${testTime}] ğŸ“¦ Content-Length:`, response.headers.get('Content-Length'));
                })
                .catch(error => {
                    console.log(`[${testTime}] âŒ æ–‡ä»¶ç„¡æ³•è¨ªå•:`, error.message);
                });
        }

        // é¡¯ç¤ºçµæœ
        function showResult(containerId, data, isError = false) {
            const container = $('#' + containerId);
            const bgColor = isError ? 'bg-red-50 border-red-200' : 'bg-green-50 border-green-200';
            const textColor = isError ? 'text-red-800' : 'text-green-800';
            
            container.removeClass('loading');
            container.html(`
                <div class="response-container p-4 rounded-md border ${bgColor} ${textColor}">
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                </div>
            `);
        }

        // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
        function showLoading(containerId) {
            const container = $('#' + containerId);
            container.addClass('loading');
            container.html(`
                <div class="response-container p-4 rounded-md border bg-blue-50 border-blue-200 text-blue-800">
                    <p>ğŸ”„ è™•ç†ä¸­ï¼Œè«‹ç¨å€™...</p>
                </div>
            `);
        }

        // TabåŠŸèƒ½
        function showTab(tabName) {
            $('.tab-content').addClass('hidden');
            $('#' + tabName + '-tab').removeClass('hidden');
            
            $('.tab-btn').removeClass('active border-blue-500 text-blue-600').addClass('border-transparent text-gray-500');
            $('button[onclick="showTab(\'' + tabName + '\')"]').removeClass('border-transparent text-gray-500').addClass('active border-blue-500 text-blue-600');
        }

        // æœå‹™ç‹€æ…‹æª¢æŸ¥
        function checkStatus() {
            showLoading('statusResult');
            makeApiCall('/v1/toolkit/test')
                .done(data => showResult('statusResult', data))
                .fail(xhr => showResult('statusResult', {error: xhr.responseText || 'é€£æ¥å¤±æ•—'}, true));
        }

        // å¥åº·æª¢æŸ¥
        function checkHealth() {
            showLoading('statusResult');
            makeApiCall('/health')
                .done(data => showResult('statusResult', data))
                .fail(xhr => showResult('statusResult', {error: xhr.responseText || 'é€£æ¥å¤±æ•—'}, true));
        }

        // å½±ç‰‡å‰ªè¼¯æ¸¬è©¦
        function testVideoCut() {
            const videoUrl = $('#cutVideoUrl').val();
            const start = $('#cutStart').val();
            const end = $('#cutEnd').val();
            
            if (!videoUrl || !start || !end) {
                alert('è«‹å¡«å¯«æ‰€æœ‰å¿…è¦æ¬„ä½');
                return;
            }
            
            showLoading('cutResult');
            const data = {
                video_url: videoUrl,
                start_time: start,
                end_time: end
            };
            
            makeApiCall('/v1/video/cut', 'POST', data)
                .done(data => showResult('cutResult', data))
                .fail(xhr => showResult('cutResult', {error: xhr.responseText || 'è«‹æ±‚å¤±æ•—'}, true));
        }

        // å½±ç‰‡ä¿®å‰ªæ¸¬è©¦
        function testVideoTrim() {
            const videoUrl = $('#trimVideoUrl').val();
            const start = $('#trimStart').val();
            const end = $('#trimEnd').val();
            
            if (!videoUrl) {
                alert('è«‹è¼¸å…¥å½±ç‰‡URL');
                return;
            }
            
            showLoading('trimResult');
            const data = {
                video_url: videoUrl,
                start_time: start || '00:00:00',
                end_time: end || '00:00:10'
            };
            
            makeApiCall('/v1/video/trim', 'POST', data)
                .done(data => showResult('trimResult', data))
                .fail(xhr => showResult('trimResult', {error: xhr.responseText || 'è«‹æ±‚å¤±æ•—'}, true));
        }

        // ç¸®åœ–ç”Ÿæˆæ¸¬è©¦
        function testVideoThumbnail() {
            const videoUrl = $('#thumbnailVideoUrl').val();
            const time = $('#thumbnailTime').val();
            
            if (!videoUrl || !time) {
                alert('è«‹å¡«å¯«æ‰€æœ‰å¿…è¦æ¬„ä½');
                return;
            }
            
            showLoading('thumbnailResult');
            const data = {
                video_url: videoUrl,
                timestamp: time
            };
            
            makeApiCall('/v1/video/thumbnail', 'POST', data)
                .done(data => showResult('thumbnailResult', data))
                .fail(xhr => showResult('thumbnailResult', {error: xhr.responseText || 'è«‹æ±‚å¤±æ•—'}, true));
        }

        // éŸ³é »åˆä½µæ¸¬è©¦
        function testAudioConcatenate() {
            const urlsText = $('#audioUrls').val();
            const urls = urlsText.split('\n').filter(url => url.trim());
            
            if (urls.length < 2) {
                alert('è«‹è‡³å°‘è¼¸å…¥å…©å€‹éŸ³é »URL');
                return;
            }
            
            showLoading('audioResult');
            const data = {
                audio_urls: urls
            };
            
            makeApiCall('/v1/audio/concatenate', 'POST', data)
                .done(data => showResult('audioResult', data))
                .fail(xhr => showResult('audioResult', {error: xhr.responseText || 'è«‹æ±‚å¤±æ•—'}, true));
        }

        // éŸ³é »è½‰éŒ„æ¸¬è©¦
        function testTranscribe() {
            const url = $('#transcribeUrl').val();
            const language = $('#transcribeLanguage').val();
            
            if (!url) {
                alert('è«‹è¼¸å…¥åª’é«”URL');
                return;
            }
            
            showLoading('transcribeResult');
            const data = {
                media_url: url,
                language: language || undefined,
                include_text: $('#includeText').is(':checked'),
                include_srt: $('#includeSrt').is(':checked'),
                include_segments: $('#includeSegments').is(':checked'),
                word_timestamps: $('#wordTimestamps').is(':checked')
            };
            
            makeApiCall('/v1/media/transcribe', 'POST', data)
                .done(data => showResult('transcribeResult', data))
                .fail(xhr => showResult('transcribeResult', {error: xhr.responseText || 'è«‹æ±‚å¤±æ•—'}, true));
        }

        // å½±ç‰‡å­—å¹•æ¸¬è©¦
        function testVideoCaption() {
            const videoUrl = $('#captionVideoUrl').val();
            const text = $('#captionText').val();
            
            if (!videoUrl) {
                alert('è«‹è¼¸å…¥å½±ç‰‡URL');
                return;
            }
            
            showLoading('captionResult');
            const data = {
                video_url: videoUrl,
                captions: text || undefined
            };
            
            makeApiCall('/v1/video/caption', 'POST', data)
                .done(data => showResult('captionResult', data))
                .fail(xhr => showResult('captionResult', {error: xhr.responseText || 'è«‹æ±‚å¤±æ•—'}, true));
        }

        // åœ–ç‰‡è½‰å½±ç‰‡æ¸¬è©¦
        function testImageToVideo() {
            const imageUrl = $('#imageVideoUrl').val();
            const duration = $('#videoDuration').val();
            const zoom = $('#zoomEffect').val();
            
            if (!imageUrl) {
                alert('è«‹è¼¸å…¥åœ–ç‰‡URL');
                return;
            }
            
            showLoading('imageVideoResult');
            const data = {
                image_url: imageUrl,
                duration: parseInt(duration),
                zoom_effect: zoom
            };
            
            makeApiCall('/v1/image/convert/video', 'POST', data)
                .done(data => showResult('imageVideoResult', data))
                .fail(xhr => showResult('imageVideoResult', {error: xhr.responseText || 'è«‹æ±‚å¤±æ•—'}, true));
        }

        // ä»»å‹™ç‹€æ…‹æŸ¥è©¢
        function checkJobStatus() {
            const jobId = $('#jobId').val();
            
            if (!jobId) {
                alert('è«‹è¼¸å…¥ä»»å‹™ID');
                return;
            }
            
            showLoading('jobStatusResult');
            makeApiCall(`/v1/job/status/${jobId}`)
                .done(data => showResult('jobStatusResult', data))
                .fail(xhr => showResult('jobStatusResult', {error: xhr.responseText || 'æŸ¥è©¢å¤±æ•—'}, true));
        }

        // ğŸš¨ æ–°å¢ï¼šæ•¸æ“šåº«ç®¡ç†å‡½æ•¸
        // æ•¸æ“šåº«æ¸¬è©¦
        function testDatabase() {
            const currentTime = new Date().toLocaleTimeString();
            console.log(`[${currentTime}] ğŸ§ª é–‹å§‹æ•¸æ“šåº«é€£æ¥æ¸¬è©¦`);
            
            showLoading('statusResult');
            makeApiCall('/v1/database/test')
                .done(data => {
                    console.log(`[${currentTime}] âœ… æ•¸æ“šåº«æ¸¬è©¦æˆåŠŸ:`, data);
                    showResult('statusResult', data);
                })
                .fail(xhr => {
                    console.log(`[${currentTime}] âŒ æ•¸æ“šåº«æ¸¬è©¦å¤±æ•—:`, xhr);
                    showResult('statusResult', {error: xhr.responseText || 'æ•¸æ“šåº«æ¸¬è©¦å¤±æ•—'}, true);
                });
        }

        // åˆå§‹åŒ–æ•¸æ“šåº«
        function initDatabase() {
            const currentTime = new Date().toLocaleTimeString();
            console.log(`[${currentTime}] ğŸ› ï¸ é–‹å§‹æ•¸æ“šåº«åˆå§‹åŒ–`);
            
            showLoading('statusResult');
            makeApiCall('/v1/database/init', 'POST')
                .done(data => {
                    console.log(`[${currentTime}] âœ… æ•¸æ“šåº«åˆå§‹åŒ–æˆåŠŸ:`, data);
                    showResult('statusResult', data);
                })
                .fail(xhr => {
                    console.log(`[${currentTime}] âŒ æ•¸æ“šåº«åˆå§‹åŒ–å¤±æ•—:`, xhr);
                    showResult('statusResult', {error: xhr.responseText || 'æ•¸æ“šåº«åˆå§‹åŒ–å¤±æ•—'}, true);
                });
        }

        // ç²å–æ•¸æ“šåº«çµ±è¨ˆ
        function getDatabaseStats() {
            const currentTime = new Date().toLocaleTimeString();
            console.log(`[${currentTime}] ğŸ“Š é–‹å§‹ç²å–æ•¸æ“šåº«çµ±è¨ˆ`);
            
            showLoading('statusResult');
            makeApiCall('/v1/database/stats')
                .done(data => {
                    console.log(`[${currentTime}] âœ… æ•¸æ“šåº«çµ±è¨ˆç²å–æˆåŠŸ:`, data);
                    showResult('statusResult', data);
                })
                .fail(xhr => {
                    console.log(`[${currentTime}] âŒ æ•¸æ“šåº«çµ±è¨ˆç²å–å¤±æ•—:`, xhr);
                    showResult('statusResult', {error: xhr.responseText || 'æ•¸æ“šåº«çµ±è¨ˆç²å–å¤±æ•—'}, true);
                });
        }

        // ğŸš¨ æ–°å¢ï¼šæ–‡ä»¶ä¸Šå‚³åŠŸèƒ½
        // éŸ³é »æ–‡ä»¶ä¸Šå‚³
        function uploadAudioFile() {
            const fileInput = document.getElementById('audioFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('è«‹é¸æ“‡éŸ³é »æ–‡ä»¶');
                return;
            }
            
            const currentTime = new Date().toLocaleTimeString();
            console.log(`[${currentTime}] ğŸ§ é–‹å§‹ä¸Šå‚³éŸ³é »æ–‡ä»¶: ${file.name}, å¤§å°: ${(file.size / 1024 / 1024).toFixed(2)}MB`);
            
            showLoading('audioUploadResult');
            
            const formData = new FormData();
            formData.append('file', file);
            formData.append('file_type', 'audio');
            
            uploadFile(formData, '/v1/files/upload/audio', 'audioUploadResult');
        }

        // è¦–é »æ–‡ä»¶ä¸Šå‚³
        function uploadVideoFile() {
            const fileInput = document.getElementById('videoFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('è«‹é¸æ“‡è¦–é »æ–‡ä»¶');
                return;
            }
            
            const currentTime = new Date().toLocaleTimeString();
            console.log(`[${currentTime}] ğŸ¥ é–‹å§‹ä¸Šå‚³è¦–é »æ–‡ä»¶: ${file.name}, å¤§å°: ${(file.size / 1024 / 1024).toFixed(2)}MB`);
            
            showLoading('videoUploadResult');
            
            const formData = new FormData();
            formData.append('file', file);
            formData.append('file_type', 'video');
            
            uploadFile(formData, '/v1/files/upload/video', 'videoUploadResult');
        }

        // é€šç”¨æ–‡ä»¶ä¸Šå‚³å‡½æ•¸
        function uploadFile(formData, endpoint, resultContainerId) {
            const baseUrl = $('#baseUrl').val();
            const apiKey = $('#apiKey').val();
            const startTime = Date.now();
            const currentTime = new Date().toLocaleTimeString();
            
            console.log(`[${currentTime}] ğŸš€ æ–‡ä»¶ä¸Šå‚³é–‹å§‹: ${endpoint}`);
            
            $.ajax({
                url: baseUrl + endpoint,
                method: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                headers: {
                    'x-api-key': apiKey
                },
                timeout: 300000, // 5åˆ†é˜è¶…æ™‚
                success: function(response) {
                    const endTime = Date.now();
                    const uploadTime = endTime - startTime;
                    const endTimeStr = new Date().toLocaleTimeString();
                    
                    console.log(`[${endTimeStr}] âœ… æ–‡ä»¶ä¸Šå‚³æˆåŠŸ (${uploadTime}ms):`, response);
                    
                    if (response && response.file_url) {
                        console.log(`[${endTimeStr}] ğŸ“ æ–‡ä»¶URL: ${response.file_url}`);
                        console.log(`[${endTimeStr}] ğŸ“ æ–‡ä»¶å¤§å°: ${response.file_size || 'æœªçŸ¥'}`);
                        
                        // æ¸¬è©¦æ–‡ä»¶URLå¤–éƒ¨å¯è¨ªå•æ€§
                        testFileAccess(response.file_url);
                        
                        // è‡ªå‹•æ›´æ–°ä¸Šå‚³æ­·å²
                        refreshUploadHistory();
                    }
                    
                    showResult(resultContainerId, response);
                },
                error: function(xhr, status, error) {
                    const endTime = Date.now();
                    const uploadTime = endTime - startTime;
                    const endTimeStr = new Date().toLocaleTimeString();
                    
                    console.log(`[${endTimeStr}] âŒ æ–‡ä»¶ä¸Šå‚³å¤±æ•— (${uploadTime}ms):`);
                    console.log(`[${endTimeStr}] ğŸ“Š HTTPç‹€æ…‹: ${xhr.status}`);
                    console.log(`[${endTimeStr}] ğŸ“Š éŒ¯èª¤é¡å‹: ${status}`);
                    console.log(`[${endTimeStr}] ğŸ“Š éŒ¯èª¤è©³æƒ…: ${error}`);
                    console.log(`[${endTimeStr}] ğŸ“Š éŸ¿æ‡‰æ–‡æœ¬: ${xhr.responseText}`);
                    
                    showResult(resultContainerId, {
                        error: xhr.responseText || 'æ–‡ä»¶ä¸Šå‚³å¤±æ•—',
                        status: xhr.status,
                        error_type: status
                    }, true);
                }
            });
        }

        // åˆ·æ–°ä¸Šå‚³æ­·å²
        function refreshUploadHistory() {
            const currentTime = new Date().toLocaleTimeString();
            console.log(`[${currentTime}] ğŸ”„ åˆ·æ–°ä¸Šå‚³æ­·å²`);
            
            makeApiCall('/v1/files/list', 'GET')
                .done(data => {
                    console.log(`[${currentTime}] âœ… ä¸Šå‚³æ­·å²ç²å–æˆåŠŸ:`, data);
                    displayUploadHistory(data);
                })
                .fail(xhr => {
                    console.log(`[${currentTime}] âŒ ä¸Šå‚³æ­·å²ç²å–å¤±æ•—:`, xhr);
                    $('#uploadHistory').html('<p class="text-red-500">ç²å–ä¸Šå‚³æ­·å²å¤±æ•—</p>');
                });
        }

        // é¡¯ç¤ºä¸Šå‚³æ­·å²
        function displayUploadHistory(data) {
            const container = $('#uploadHistory');
            
            if (!data || !data.files || data.files.length === 0) {
                container.html('<p class="text-gray-500">å°šç„¡ä¸Šå‚³æ–‡ä»¶</p>');
                return;
            }
            
            let html = '<div class="space-y-2">';
            
            data.files.forEach(file => {
                const fileType = file.file_type === 'audio' ? 'ğŸ§' : 'ğŸ¥';
                const fileSize = file.file_size ? `(${(file.file_size / 1024 / 1024).toFixed(2)}MB)` : '';
                const uploadTime = new Date(file.created_at).toLocaleString();
                
                html += `
                    <div class="border border-gray-200 rounded-lg p-3 bg-gray-50">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="font-medium">${fileType} ${file.original_filename} ${fileSize}</p>
                                <p class="text-sm text-gray-600">ä¸Šå‚³æ™‚é–“: ${uploadTime}</p>
                                <p class="text-xs text-blue-600 break-all">
                                    <a href="${file.file_url}" target="_blank" class="hover:underline">${file.file_url}</a>
                                </p>
                            </div>
                            <button onclick="copyToClipboard('${file.file_url}')" 
                                    class="bg-green-500 hover:bg-green-700 text-white text-xs px-2 py-1 rounded">
                                è¤‡è£½ URL
                            </button>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.html(html);
        }

        // è¤‡è£½åˆ°å‰ªè²¼æ¿
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                const currentTime = new Date().toLocaleTimeString();
                console.log(`[${currentTime}] ğŸ“‹ URLå·²è¤‡è£½åˆ°å‰ªè²¼æ¿: ${text}`);
                alert('ğŸ“‹ URLå·²è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼');
            }).catch(err => {
                console.error('è¤‡è£½å¤±æ•—:', err);
                alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½');
            });
        }

        // åˆå§‹åŒ–
        $(document).ready(function() {
            console.log('ğŸš€ No-Code Architects Toolkit é›²ç«¯æ¸¬è©¦ä¸­å¿ƒå·²è¼‰å…¥');
            console.log('ğŸ”— ä½¿ç”¨æœ¬åœ°æˆåŠŸçš„APIç«¯é»');
            console.log('ğŸ“ æ–°å¢æœ¬åœ°æ–‡ä»¶ä¸Šå‚³åŠŸèƒ½');
            
            // è‡ªå‹•æª¢æŸ¥å¥åº·ç‹€æ…‹
            checkHealth();
            
            // è¼‰å…¥ä¸Šå‚³æ­·å²
            refreshUploadHistory();
        });
    </script>
</body>
</html>
