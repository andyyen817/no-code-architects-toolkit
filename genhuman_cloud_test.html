<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GenHuman API é›²ç«¯æ¸¬è©¦ä¸­å¿ƒ</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            max-width: 1600px; 
            margin: 0 auto; 
            padding: 20px; 
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
        }
        .header {
            background: rgba(255,255,255,0.95);
            color: #2c3e50;
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(480px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        .test-section { 
            background: rgba(255,255,255,0.95);
            padding: 30px; 
            border-radius: 20px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .test-section:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }
        .test-section h3 { 
            color: #2c3e50; 
            margin-top: 0; 
            border-bottom: 4px solid #6a11cb;
            padding-bottom: 15px;
            font-size: 1.4em;
        }
        .form-group { 
            margin: 20px 0; 
        }
        .form-group label { 
            display: block; 
            margin-bottom: 10px; 
            font-weight: 600;
            color: #34495e;
            font-size: 1.1em;
        }
        .form-group input, .form-group textarea, .form-group select { 
            width: 100%; 
            padding: 15px; 
            border: 3px solid #e1e8ed; 
            border-radius: 10px; 
            font-size: 15px;
            transition: all 0.3s ease;
        }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            border-color: #6a11cb;
            outline: none;
            box-shadow: 0 0 0 4px rgba(106, 17, 203, 0.1);
        }
        .btn { 
            padding: 15px 30px; 
            background: linear-gradient(135deg, #6a11cb, #2575fc); 
            color: white; 
            border: none; 
            border-radius: 10px; 
            cursor: pointer; 
            margin: 10px 8px; 
            font-weight: 600;
            font-size: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(106, 17, 203, 0.3);
        }
        .btn:hover { 
            background: linear-gradient(135deg, #2575fc, #6a11cb); 
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(106, 17, 203, 0.4);
        }
        .btn:disabled { 
            background: #bdc3c7; 
            cursor: not-allowed; 
            transform: none;
            box-shadow: none;
        }
        .btn-success { 
            background: linear-gradient(135deg, #00b894, #00cec9); 
            box-shadow: 0 5px 15px rgba(0, 184, 148, 0.3);
        }
        .btn-success:hover { 
            background: linear-gradient(135deg, #00cec9, #74b9ff); 
        }
        .btn-warning { 
            background: linear-gradient(135deg, #fdcb6e, #e17055); 
            box-shadow: 0 5px 15px rgba(253, 203, 110, 0.3);
        }
        .btn-warning:hover { 
            background: linear-gradient(135deg, #e17055, #d63031); 
        }
        .btn-danger { 
            background: linear-gradient(135deg, #e84393, #fd79a8); 
            box-shadow: 0 5px 15px rgba(232, 67, 147, 0.3);
        }
        .btn-danger:hover { 
            background: linear-gradient(135deg, #fd79a8, #fdcb6e); 
        }
        
        .result { 
            margin-top: 25px; 
            padding: 20px; 
            border-radius: 12px; 
            white-space: pre-wrap; 
            font-family: 'Courier New', monospace;
            font-size: 14px;
            border: 3px solid;
        }
        .success { 
            background: rgba(212, 244, 230, 0.9); 
            border-color: #00b894; 
            color: #00875f; 
        }
        .error { 
            background: rgba(255, 235, 238, 0.9); 
            border-color: #e84393; 
            color: #c44569; 
        }
        .log { 
            background: rgba(248, 249, 250, 0.9); 
            border-color: #dee2e6; 
            color: #495057; 
            max-height: 350px; 
            overflow-y: auto;
        }
        
        .stats-panel {
            background: rgba(255,255,255,0.95);
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        .stat-item {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .stat-number {
            font-size: 28px;
            font-weight: bold;
            color: #6a11cb;
        }
        .stat-label {
            font-size: 15px;
            color: #7f8c8d;
            margin-top: 8px;
        }
        
        .progress-bar {
            width: 100%;
            height: 25px;
            background: #ecf0f1;
            border-radius: 15px;
            overflow: hidden;
            margin: 15px 0;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #6a11cb, #2575fc);
            transition: width 0.5s ease;
        }
        
        .status-indicator {
            display: inline-block;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 10px;
        }
        .status-healthy { background: #00b894; }
        .status-error { background: #e84393; }
        .status-processing { 
            background: #fdcb6e; 
            animation: genhuman-pulse 2s infinite; 
        }
        
        @keyframes genhuman-pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.2); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        .genhuman-logo {
            font-size: 3em;
            color: #6a11cb;
            margin-bottom: 15px;
        }
        
        .api-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 5px solid #6a11cb;
            font-family: 'Courier New', monospace;
        }
        
        .task-status {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            display: inline-block;
            margin: 5px;
        }
        .status-pending { background: #ddd; color: #666; }
        .status-processing { background: #fff3cd; color: #856404; }
        .status-completed { background: #d4edda; color: #155724; }
        .status-failed { background: #f8d7da; color: #721c24; }
        
        .callback-panel {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
        }
        
        .file-upload-area {
            border: 3px dashed #6a11cb;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            transition: all 0.3s ease;
            margin: 15px 0;
        }
        .file-upload-area:hover {
            border-color: #2575fc;
            background: rgba(106, 17, 203, 0.05);
        }
        .file-upload-area.dragover {
            border-color: #00b894;
            background: rgba(0, 184, 148, 0.1);
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="genhuman-logo">ğŸ¤–</div>
        <h1>GenHuman API é›²ç«¯æ¸¬è©¦ä¸­å¿ƒ</h1>
        <p>åŸºæ–¼å‰ç«¯æˆåŠŸç¶“é©— | å®Œæ•´APIæ¸¬è©¦ | MySQLæ•¸æ“šæŒä¹…åŒ–</p>
        <div>
            <span class="status-indicator" id="genhumanStatus"></span>
            <span id="genhumanStatusText">æ­£åœ¨æª¢æŸ¥GenHuman APIç‹€æ…‹...</span>
        </div>
    </div>

    <!-- GenHumanæ¸¬è©¦çµ±è¨ˆé¢æ¿ -->
    <div class="stats-panel">
        <h3>ğŸ“Š GenHuman API æ¸¬è©¦çµ±è¨ˆ</h3>
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-number" id="genhumanTotalCalls">0</div>
                <div class="stat-label">ç¸½APIèª¿ç”¨</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="genhumanSuccessCalls">0</div>
                <div class="stat-label">æˆåŠŸèª¿ç”¨</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="genhumanProcessingTasks">0</div>
                <div class="stat-label">è™•ç†ä¸­ä»»å‹™</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="genhumanCompletedTasks">0</div>
                <div class="stat-label">å®Œæˆä»»å‹™</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="genhumanAvgTime">0s</div>
                <div class="stat-label">å¹³å‡éŸ¿æ‡‰æ™‚é–“</div>
            </div>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" id="genhumanSuccessRate" style="width: 0%"></div>
        </div>
        <div style="text-align: center; margin-top: 12px; font-size: 16px;">
            APIæˆåŠŸç‡: <span id="genhumanSuccessRateText">0%</span>
        </div>
    </div>

    <!-- GenHuman APIæ¸¬è©¦åŠŸèƒ½ç¶²æ ¼ -->
    <div class="test-grid">
        <!-- è²éŸ³å…‹éš†æ¸¬è©¦ -->
        <div class="test-section">
            <h3>ğŸ¤ è²éŸ³å…‹éš† API æ¸¬è©¦</h3>
            
            <div class="form-group">
                <label>è²éŸ³åç¨±ï¼š</label>
                <input type="text" id="voiceName" placeholder="ä¾‹å¦‚ï¼šæˆ‘çš„å°ˆå±¬è²éŸ³" value="æ¸¬è©¦è²éŸ³_é›²ç«¯">
            </div>
            
            <div class="file-upload-area" id="voiceUploadArea">
                <p>ğŸ“¤ æ‹–æ”¾éŸ³é »æ–‡ä»¶åˆ°é€™è£¡æˆ–é»æ“Šé¸æ“‡</p>
                <input type="file" id="voiceAudioFile" accept="audio/*" style="display:none;">
                <button class="btn" onclick="document.getElementById('voiceAudioFile').click()">é¸æ“‡éŸ³é »æ–‡ä»¶</button>
            </div>
            
            <div class="form-group">
                <label>æˆ–è€…è¼¸å…¥éŸ³é »URLï¼š</label>
                <input type="url" id="voiceAudioUrl" placeholder="https://example.com/audio.mp3">
            </div>
            
            <div class="form-group">
                <label>èªè¨€è¨­ç½®ï¼š</label>
                <select id="voiceLanguage">
                    <option value="zh">ä¸­æ–‡</option>
                    <option value="en">English</option>
                    <option value="ja">æ—¥æœ¬èª</option>
                    <option value="ko">í•œêµ­ì–´</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>éŸ³é »è³ªé‡ï¼š</label>
                <select id="voiceQuality">
                    <option value="high">é«˜è³ªé‡</option>
                    <option value="medium">ä¸­ç­‰è³ªé‡</option>
                    <option value="low">ä½è³ªé‡</option>
                </select>
            </div>
            
            <div class="api-info">
                APIç«¯é»: POST /api/v1/voice_clone<br>
                å›èª¿åœ°å€: https://vidsparkback.zeabur.app/api/genhuman/voice-clone/callback
            </div>
            
            <button class="btn" onclick="testVoiceClone()">ğŸµ é–‹å§‹è²éŸ³å…‹éš†</button>
            <button class="btn btn-success" onclick="checkVoiceCloneStatus()">ğŸ“Š æª¢æŸ¥å…‹éš†ç‹€æ…‹</button>
            <button class="btn btn-warning" onclick="listVoiceClones()">ğŸ“‹ å…‹éš†æ­·å²</button>
            
            <div id="voiceCloneResult" class="result"></div>
            <div id="voiceCloneLog" class="result log"></div>
        </div>

        <!-- æ•¸å­—äººå…‹éš†æ¸¬è©¦ -->
        <div class="test-section">
            <h3>ğŸ‘¤ æ•¸å­—äººå…‹éš† API æ¸¬è©¦</h3>
            
            <div class="form-group">
                <label>è§’è‰²åç¨±ï¼š</label>
                <input type="text" id="characterName" placeholder="ä¾‹å¦‚ï¼šæˆ‘çš„æ•¸å­—åˆ†èº«" value="æ¸¬è©¦æ•¸å­—äºº_é›²ç«¯">
            </div>
            
            <div class="file-upload-area" id="imageUploadArea">
                <p>ğŸ“¤ æ‹–æ”¾åœ–ç‰‡æ–‡ä»¶åˆ°é€™è£¡æˆ–é»æ“Šé¸æ“‡</p>
                <input type="file" id="characterImageFile" accept="image/*" style="display:none;">
                <button class="btn" onclick="document.getElementById('characterImageFile').click()">é¸æ“‡åœ–ç‰‡æ–‡ä»¶</button>
            </div>
            
            <div class="form-group">
                <label>æˆ–è€…è¼¸å…¥åœ–ç‰‡URLï¼š</label>
                <input type="url" id="characterImageUrl" placeholder="https://example.com/image.jpg">
            </div>
            
            <div class="form-group">
                <label>æ•¸å­—äººé¡å‹ï¼š</label>
                <select id="characterType">
                    <option value="realistic">çœŸå¯¦äººç‰©</option>
                    <option value="cartoon">å¡é€šé¢¨æ ¼</option>
                    <option value="anime">å‹•æ¼«é¢¨æ ¼</option>
                    <option value="custom">è‡ªå®šç¾©é¢¨æ ¼</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>è¡¨æƒ…è¨­ç½®ï¼š</label>
                <select id="characterExpression">
                    <option value="neutral">ä¸­æ€§è¡¨æƒ…</option>
                    <option value="smile">å¾®ç¬‘</option>
                    <option value="serious">åš´è‚…</option>
                    <option value="friendly">å‹å¥½</option>
                </select>
            </div>
            
            <div class="api-info">
                APIç«¯é»: POST /api/v1/digital_human_clone<br>
                å›èª¿åœ°å€: https://vidsparkback.zeabur.app/api/genhuman/digital-human/callback
            </div>
            
            <button class="btn" onclick="testDigitalHumanClone()">ğŸ‘¨â€ğŸ’¼ é–‹å§‹æ•¸å­—äººå…‹éš†</button>
            <button class="btn btn-success" onclick="checkDigitalHumanStatus()">ğŸ“Š æª¢æŸ¥å…‹éš†ç‹€æ…‹</button>
            <button class="btn btn-warning" onclick="listDigitalHumans()">ğŸ“‹ å…‹éš†æ­·å²</button>
            
            <div id="digitalHumanResult" class="result"></div>
            <div id="digitalHumanLog" class="result log"></div>
        </div>

        <!-- èªéŸ³åˆæˆæ¸¬è©¦ -->
        <div class="test-section">
            <h3>ğŸ”Š èªéŸ³åˆæˆ API æ¸¬è©¦</h3>
            
            <div class="form-group">
                <label>åˆæˆæ–‡æœ¬ï¼š</label>
                <textarea id="synthesisText" rows="4" placeholder="è¼¸å…¥è¦åˆæˆèªéŸ³çš„æ–‡æœ¬å…§å®¹...">æ­¡è¿ä½¿ç”¨GenHuman APIé›²ç«¯æ¸¬è©¦ä¸­å¿ƒï¼Œé€™æ˜¯ä¸€å€‹å®Œæ•´çš„èªéŸ³åˆæˆæ¸¬è©¦ã€‚</textarea>
            </div>
            
            <div class="form-group">
                <label>é¸æ“‡å…‹éš†çš„è²éŸ³ï¼š</label>
                <select id="synthesisVoiceId">
                    <option value="">è«‹å…ˆå®Œæˆè²éŸ³å…‹éš†</option>
                </select>
                <button class="btn btn-warning" onclick="loadAvailableVoices()">ğŸ”„ åˆ·æ–°è²éŸ³åˆ—è¡¨</button>
            </div>
            
            <div class="form-group">
                <label>èªé€Ÿè¨­ç½®ï¼š</label>
                <select id="synthesisSpeed">
                    <option value="slow">æ…¢é€Ÿ (0.8x)</option>
                    <option value="normal">æ­£å¸¸ (1.0x)</option>
                    <option value="fast">å¿«é€Ÿ (1.2x)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>éŸ³èª¿è¨­ç½®ï¼š</label>
                <select id="synthesisPitch">
                    <option value="low">ä½éŸ³èª¿</option>
                    <option value="normal">æ­£å¸¸éŸ³èª¿</option>
                    <option value="high">é«˜éŸ³èª¿</option>
                </select>
            </div>
            
            <div class="api-info">
                APIç«¯é»: POST /api/v1/text_to_speech<br>
                å›èª¿åœ°å€: https://vidsparkback.zeabur.app/api/genhuman/tts/callback
            </div>
            
            <button class="btn" onclick="testTextToSpeech()">ğŸ”Š é–‹å§‹èªéŸ³åˆæˆ</button>
            <button class="btn btn-success" onclick="checkTTSStatus()">ğŸ“Š æª¢æŸ¥åˆæˆç‹€æ…‹</button>
            <button class="btn btn-warning" onclick="listTTSHistory()">ğŸ“‹ åˆæˆæ­·å²</button>
            
            <div id="ttsResult" class="result"></div>
            <div id="ttsLog" class="result log"></div>
        </div>

        <!-- æ•¸å­—äººè¦–é »ç”Ÿæˆæ¸¬è©¦ -->
        <div class="test-section">
            <h3>ğŸ¬ æ•¸å­—äººè¦–é »ç”Ÿæˆæ¸¬è©¦</h3>
            
            <div class="form-group">
                <label>è¦–é »è…³æœ¬ï¼š</label>
                <textarea id="videoScript" rows="4" placeholder="è¼¸å…¥æ•¸å­—äººè¦èªªçš„å…§å®¹...">å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯é€šéGenHuman APIå‰µå»ºçš„æ•¸å­—äººã€‚é€™æ˜¯ä¸€å€‹å®Œæ•´çš„è¦–é »ç”Ÿæˆæ¸¬è©¦ï¼Œå±•ç¤ºäº†å¾æ–‡æœ¬åˆ°è¦–é »çš„å®Œæ•´æµç¨‹ã€‚</textarea>
            </div>
            
            <div class="form-group">
                <label>é¸æ“‡æ•¸å­—äººï¼š</label>
                <select id="videoDigitalHumanId">
                    <option value="">è«‹å…ˆå®Œæˆæ•¸å­—äººå…‹éš†</option>
                </select>
                <button class="btn btn-warning" onclick="loadAvailableDigitalHumans()">ğŸ”„ åˆ·æ–°æ•¸å­—äººåˆ—è¡¨</button>
            </div>
            
            <div class="form-group">
                <label>é¸æ“‡è²éŸ³ï¼š</label>
                <select id="videoVoiceId">
                    <option value="">é¸æ“‡è²éŸ³ï¼ˆå¯é¸ï¼‰</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>è¦–é »åˆ†è¾¨ç‡ï¼š</label>
                <select id="videoResolution">
                    <option value="720p">720p (1280x720)</option>
                    <option value="1080p">1080p (1920x1080)</option>
                    <option value="4k">4K (3840x2160)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>èƒŒæ™¯è¨­ç½®ï¼š</label>
                <select id="videoBackground">
                    <option value="default">é»˜èªèƒŒæ™¯</option>
                    <option value="office">è¾¦å…¬å®¤</option>
                    <option value="studio">æ¼”æ’­å»³</option>
                    <option value="custom">è‡ªå®šç¾©</option>
                </select>
            </div>
            
            <div class="api-info">
                APIç«¯é»: POST /api/v1/digital_human_video<br>
                å›èª¿åœ°å€: https://vidsparkback.zeabur.app/api/genhuman/video/callback
            </div>
            
            <button class="btn" onclick="testDigitalHumanVideo()">ğŸ¬ é–‹å§‹è¦–é »ç”Ÿæˆ</button>
            <button class="btn btn-success" onclick="checkVideoStatus()">ğŸ“Š æª¢æŸ¥ç”Ÿæˆç‹€æ…‹</button>
            <button class="btn btn-warning" onclick="listVideoHistory()">ğŸ“‹ ç”Ÿæˆæ­·å²</button>
            
            <div id="videoGenerationResult" class="result"></div>
            <div id="videoGenerationLog" class="result log"></div>
        </div>

        <!-- å›èª¿ç‹€æ…‹ç›£æ§é¢æ¿ -->
        <div class="test-section">
            <h3>ğŸ“ å›èª¿ç‹€æ…‹ç›£æ§</h3>
            
            <div class="form-group">
                <label>ç›£æ§ä»»å‹™é¡å‹ï¼š</label>
                <select id="monitorTaskType">
                    <option value="all">æ‰€æœ‰ä»»å‹™</option>
                    <option value="voice_clone">è²éŸ³å…‹éš†</option>
                    <option value="digital_human">æ•¸å­—äººå…‹éš†</option>
                    <option value="text_to_speech">èªéŸ³åˆæˆ</option>
                    <option value="video_generation">è¦–é »ç”Ÿæˆ</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>å¯¦æ™‚ç›£æ§ï¼š</label>
                <button class="btn btn-success" onclick="startCallbackMonitor()">ğŸ”„ é–‹å§‹ç›£æ§</button>
                <button class="btn btn-danger" onclick="stopCallbackMonitor()">â¹ï¸ åœæ­¢ç›£æ§</button>
                <button class="btn btn-warning" onclick="refreshAllStatus()">ğŸ”„ åˆ·æ–°æ‰€æœ‰ç‹€æ…‹</button>
            </div>
            
            <div class="callback-panel">
                <h4>ğŸ“Š ç•¶å‰æ´»èºä»»å‹™</h4>
                <div id="activeTasksDisplay">æš«ç„¡æ´»èºä»»å‹™</div>
            </div>
            
            <div class="form-group">
                <label>ä»»å‹™ç‹€æ…‹çµ±è¨ˆï¼š</label>
                <div id="taskStatusStats">
                    <span class="task-status status-pending">ç­‰å¾…ä¸­: 0</span>
                    <span class="task-status status-processing">è™•ç†ä¸­: 0</span>
                    <span class="task-status status-completed">å·²å®Œæˆ: 0</span>
                    <span class="task-status status-failed">å¤±æ•—: 0</span>
                </div>
            </div>
            
            <button class="btn" onclick="testCallbackEndpoint()">ğŸ”— æ¸¬è©¦å›èª¿ç«¯é»</button>
            <button class="btn btn-warning" onclick="simulateCallback()">ğŸ­ æ¨¡æ“¬å›èª¿</button>
            <button class="btn btn-success" onclick="exportTestResults()">ğŸ“Š å°å‡ºæ¸¬è©¦çµæœ</button>
            
            <div id="callbackResult" class="result"></div>
            <div id="callbackLog" class="result log"></div>
        </div>

        <!-- æ‰¹é‡æ¸¬è©¦å’Œå£“åŠ›æ¸¬è©¦ -->
        <div class="test-section">
            <h3>âš¡ GenHuman æ‰¹é‡æ¸¬è©¦</h3>
            
            <div class="form-group">
                <label>æ‰¹é‡æ¸¬è©¦é¡å‹ï¼š</label>
                <select id="batchTestType">
                    <option value="voice_clone_batch">æ‰¹é‡è²éŸ³å…‹éš†</option>
                    <option value="digital_human_batch">æ‰¹é‡æ•¸å­—äººå…‹éš†</option>
                    <option value="tts_batch">æ‰¹é‡èªéŸ³åˆæˆ</option>
                    <option value="integration_test">é›†æˆåŠŸèƒ½æ¸¬è©¦</option>
                    <option value="stress_test">APIå£“åŠ›æ¸¬è©¦</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>ä¸¦ç™¼ä»»å‹™æ•¸ï¼š</label>
                <select id="batchConcurrency">
                    <option value="1">å–®ä»»å‹™</option>
                    <option value="3">3ä¸¦ç™¼</option>
                    <option value="5">5ä¸¦ç™¼</option>
                    <option value="10">10ä¸¦ç™¼</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>æ¸¬è©¦è¼ªæ¬¡ï¼š</label>
                <select id="batchRounds">
                    <option value="5">5è¼ªæ¸¬è©¦</option>
                    <option value="10">10è¼ªæ¸¬è©¦</option>
                    <option value="20">20è¼ªæ¸¬è©¦</option>
                    <option value="50">50è¼ªæ¸¬è©¦</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>æ¸¬è©¦é–“éš” (ç§’)ï¼š</label>
                <select id="batchInterval">
                    <option value="5">5ç§’</option>
                    <option value="10">10ç§’</option>
                    <option value="30">30ç§’</option>
                    <option value="60">60ç§’</option>
                </select>
            </div>
            
            <button class="btn btn-success" onclick="runGenhumanBatchTest()">ğŸš€ é‹è¡Œæ‰¹é‡æ¸¬è©¦</button>
            <button class="btn btn-warning" onclick="runGenhumanStressTest()">âš¡ APIå£“åŠ›æ¸¬è©¦</button>
            <button class="btn btn-danger" onclick="stopAllTests()">ğŸ›‘ åœæ­¢æ‰€æœ‰æ¸¬è©¦</button>
            <button class="btn" onclick="clearGenhumanLogs()">ğŸ—‘ï¸ æ¸…ç©ºæ—¥èªŒ</button>
            
            <div id="batchTestResult" class="result"></div>
            <div id="batchTestLog" class="result log"></div>
        </div>
    </div>

    <script>
        // å…¨å±€è®Šé‡
        const BASE_URL = 'https://vidsparkback.zeabur.app';
        const GENHUMAN_API_BASE = 'https://api.yidevs.com';
        let genhumanStats = {
            totalCalls: 0,
            successCalls: 0,
            processingTasks: 0,
            completedTasks: 0,
            times: []
        };
        let callbackMonitorInterval = null;
        let activeTasks = new Map();

        // åˆå§‹åŒ–é é¢
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸš€ GenHuman API é›²ç«¯æ¸¬è©¦ä¸­å¿ƒå·²åŠ è¼‰');
            log('ğŸŒ æ¸¬è©¦ç’°å¢ƒ: ' + BASE_URL);
            log('ğŸ¤– GenHuman API: ' + GENHUMAN_API_BASE);
            checkGenhumanApiStatus();
            setupFileUploadAreas();
            loadTestHistory();
        });

        // è¨­ç½®æ–‡ä»¶ä¸Šå‚³å€åŸŸ
        function setupFileUploadAreas() {
            const uploadAreas = ['voiceUploadArea', 'imageUploadArea'];
            const fileInputs = ['voiceAudioFile', 'characterImageFile'];
            
            uploadAreas.forEach((areaId, index) => {
                const area = document.getElementById(areaId);
                const input = document.getElementById(fileInputs[index]);
                
                if (area && input) {
                    // æ‹–æ‹½ä¸Šå‚³
                    area.addEventListener('dragover', (e) => {
                        e.preventDefault();
                        area.classList.add('dragover');
                    });
                    
                    area.addEventListener('dragleave', () => {
                        area.classList.remove('dragover');
                    });
                    
                    area.addEventListener('drop', (e) => {
                        e.preventDefault();
                        area.classList.remove('dragover');
                        const files = e.dataTransfer.files;
                        if (files.length > 0) {
                            input.files = files;
                            handleFileSelection(input, files[0]);
                        }
                    });
                    
                    // æ–‡ä»¶é¸æ“‡
                    input.addEventListener('change', (e) => {
                        if (e.target.files.length > 0) {
                            handleFileSelection(input, e.target.files[0]);
                        }
                    });
                }
            });
        }

        // è™•ç†æ–‡ä»¶é¸æ“‡
        function handleFileSelection(input, file) {
            const areaId = input.id.includes('voice') ? 'voiceUploadArea' : 'imageUploadArea';
            const area = document.getElementById(areaId);
            
            area.innerHTML = `
                <p>âœ… å·²é¸æ“‡æ–‡ä»¶: ${file.name}</p>
                <p>ğŸ“Š æ–‡ä»¶å¤§å°: ${(file.size / 1024 / 1024).toFixed(2)} MB</p>
                <p>ğŸ“‹ æ–‡ä»¶é¡å‹: ${file.type}</p>
                <button class="btn btn-warning" onclick="document.getElementById('${input.id}').click()">ğŸ”„ é‡æ–°é¸æ“‡</button>
            `;
            
            log(`ğŸ“ æ–‡ä»¶å·²é¸æ“‡: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`);
        }

        // é€šç”¨æ—¥èªŒå‡½æ•¸
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}`;
            
            console.log(`[GenHuman Cloud Test] ${message}`);
            
            // è¼¸å‡ºåˆ°å„å€‹æ—¥èªŒå€åŸŸ
            const logElements = ['voiceCloneLog', 'digitalHumanLog', 'ttsLog', 'videoGenerationLog', 'callbackLog', 'batchTestLog'];
            logElements.forEach(logId => {
                const element = document.getElementById(logId);
                if (element) {
                    element.textContent += logMessage + '\n';
                    element.scrollTop = element.scrollHeight;
                }
            });
        }

        // é¡¯ç¤ºçµæœ
        function showResult(elementId, message, isSuccess = true) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = message;
                element.className = isSuccess ? 'result success' : 'result error';
            }
        }

        // æ›´æ–°GenHumançµ±è¨ˆ
        function updateGenhumanStats(type, success = true, responseTime = 0) {
            genhumanStats.totalCalls++;
            if (success) genhumanStats.successCalls++;
            if (responseTime > 0) genhumanStats.times.push(responseTime);
            
            if (type === 'task_created') genhumanStats.processingTasks++;
            if (type === 'task_completed') {
                genhumanStats.processingTasks = Math.max(0, genhumanStats.processingTasks - 1);
                genhumanStats.completedTasks++;
            }

            // æ›´æ–°é¡¯ç¤º
            document.getElementById('genhumanTotalCalls').textContent = genhumanStats.totalCalls;
            document.getElementById('genhumanSuccessCalls').textContent = genhumanStats.successCalls;
            document.getElementById('genhumanProcessingTasks').textContent = genhumanStats.processingTasks;
            document.getElementById('genhumanCompletedTasks').textContent = genhumanStats.completedTasks;
            
            if (genhumanStats.times.length > 0) {
                const avgTime = genhumanStats.times.reduce((a, b) => a + b, 0) / genhumanStats.times.length;
                document.getElementById('genhumanAvgTime').textContent = (avgTime / 1000).toFixed(1) + 's';
            }
            
            const successRate = genhumanStats.totalCalls > 0 ? (genhumanStats.successCalls / genhumanStats.totalCalls * 100) : 0;
            document.getElementById('genhumanSuccessRate').style.width = successRate + '%';
            document.getElementById('genhumanSuccessRateText').textContent = successRate.toFixed(1) + '%';
        }

        // æª¢æŸ¥GenHuman APIç‹€æ…‹
        async function checkGenhumanApiStatus() {
            try {
                const startTime = Date.now();
                const response = await fetch(`${BASE_URL}/api/genhuman/status`);
                const responseTime = Date.now() - startTime;
                
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('genhumanStatus').className = 'status-indicator status-healthy';
                    document.getElementById('genhumanStatusText').textContent = `GenHuman APIæ­£å¸¸ (${responseTime}ms)`;
                    log(`âœ… GenHuman APIç‹€æ…‹æª¢æŸ¥é€šé`);
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                document.getElementById('genhumanStatus').className = 'status-indicator status-error';
                document.getElementById('genhumanStatusText').textContent = 'GenHuman APIç•°å¸¸';
                log(`âŒ GenHuman APIç‹€æ…‹æª¢æŸ¥å¤±æ•—: ${error.message}`);
            }
        }

        // è¨˜éŒ„GenHumançµæœåˆ°æ•¸æ“šåº«
        async function recordGenhumanResult(apiType, taskId, requestData, callbackData, status, resultUrl = null) {
            try {
                const response = await fetch(`${BASE_URL}/api/test/genhuman/record`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        api_type: apiType,
                        task_id: taskId,
                        request_data: requestData,
                        callback_data: callbackData,
                        status: status,
                        result_url: resultUrl
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    log(`ğŸ’¾ GenHumançµæœå·²ä¿å­˜åˆ°æ•¸æ“šåº«: è¨˜éŒ„ID ${result.record_id}`);
                }
            } catch (error) {
                log(`âŒ GenHumançµæœä¿å­˜å¤±æ•—: ${error.message}`);
            }
        }

        // è²éŸ³å…‹éš†æ¸¬è©¦
        async function testVoiceClone() {
            const voiceName = document.getElementById('voiceName').value;
            const audioFile = document.getElementById('voiceAudioFile').files[0];
            const audioUrl = document.getElementById('voiceAudioUrl').value;
            const language = document.getElementById('voiceLanguage').value;
            const quality = document.getElementById('voiceQuality').value;
            
            if (!voiceName.trim()) {
                showResult('voiceCloneResult', 'è«‹è¼¸å…¥è²éŸ³åç¨±ï¼', false);
                return;
            }
            
            let mediaSource = audioUrl;
            if (audioFile && !audioUrl) {
                log(`ğŸ“¤ å…ˆä¸Šå‚³éŸ³é »æ–‡ä»¶: ${audioFile.name}`);
                const uploadResult = await uploadFileToServer(audioFile, 'audio');
                if (!uploadResult.success) {
                    showResult('voiceCloneResult', 'éŸ³é »æ–‡ä»¶ä¸Šå‚³å¤±æ•—ï¼', false);
                    return;
                }
                mediaSource = uploadResult.file_url;
            }
            
            if (!mediaSource) {
                showResult('voiceCloneResult', 'è«‹é¸æ“‡éŸ³é »æ–‡ä»¶æˆ–è¼¸å…¥éŸ³é »URLï¼', false);
                return;
            }
            
            log(`ğŸ¤ é–‹å§‹è²éŸ³å…‹éš†æ¸¬è©¦: ${voiceName}`);
            log(`ğŸ”— éŸ³é »URL: ${mediaSource}`);
            
            try {
                const startTime = Date.now();
                document.getElementById('genhumanStatus').className = 'status-indicator status-processing';
                
                const requestData = {
                    voice_name: voiceName,
                    voice_url: mediaSource,
                    language: language,
                    quality: quality,
                    callback_url: `${BASE_URL}/api/genhuman/voice-clone/callback`
                };
                
                const response = await fetch(`${BASE_URL}/api/genhuman/voice-clone/create`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(requestData)
                });
                
                const responseTime = Date.now() - startTime;
                const result = await response.json();
                
                document.getElementById('genhumanStatus').className = 'status-indicator status-healthy';
                
                if (result.success) {
                    const taskId = result.task_id || result.taskId;
                    activeTasks.set(taskId, {
                        type: 'voice_clone',
                        name: voiceName,
                        status: 'processing',
                        startTime: new Date().toLocaleString()
                    });
                    
                    log(`âœ… è²éŸ³å…‹éš†ä»»å‹™å‰µå»ºæˆåŠŸï¼ä»»å‹™ID: ${taskId}`);
                    log(`â° é è¨ˆå®Œæˆæ™‚é–“: ${result.estimated_time || '5-10åˆ†é˜'}`);
                    
                    showResult('voiceCloneResult', 
                        `è²éŸ³å…‹éš†ä»»å‹™å·²å‰µå»ºï¼\n` +
                        `ä»»å‹™ID: ${taskId}\n` +
                        `è²éŸ³åç¨±: ${voiceName}\n` +
                        `éŸ³é »ä¾†æº: ${mediaSource}\n` +
                        `èªè¨€: ${language}\n` +
                        `è³ªé‡: ${quality}\n` +
                        `ç‹€æ…‹: è™•ç†ä¸­\n` +
                        `éŸ¿æ‡‰æ™‚é–“: ${responseTime}ms`
                    );
                    
                    await recordGenhumanResult('voice_clone', taskId, requestData, null, 'processing');
                    updateGenhumanStats('task_created', true, responseTime);
                } else {
                    throw new Error(result.error || 'è²éŸ³å…‹éš†ä»»å‹™å‰µå»ºå¤±æ•—');
                }
            } catch (error) {
                const responseTime = Date.now() - startTime;
                document.getElementById('genhumanStatus').className = 'status-indicator status-error';
                log(`âŒ è²éŸ³å…‹éš†å¤±æ•—: ${error.message}`);
                showResult('voiceCloneResult', `è²éŸ³å…‹éš†å¤±æ•—: ${error.message}`, false);
                updateGenhumanStats('call_failed', false, responseTime);
            }
        }

        // æ•¸å­—äººå…‹éš†æ¸¬è©¦
        async function testDigitalHumanClone() {
            const characterName = document.getElementById('characterName').value;
            const imageFile = document.getElementById('characterImageFile').files[0];
            const imageUrl = document.getElementById('characterImageUrl').value;
            const characterType = document.getElementById('characterType').value;
            const expression = document.getElementById('characterExpression').value;
            
            if (!characterName.trim()) {
                showResult('digitalHumanResult', 'è«‹è¼¸å…¥è§’è‰²åç¨±ï¼', false);
                return;
            }
            
            let mediaSource = imageUrl;
            if (imageFile && !imageUrl) {
                log(`ğŸ“¤ å…ˆä¸Šå‚³åœ–ç‰‡æ–‡ä»¶: ${imageFile.name}`);
                const uploadResult = await uploadFileToServer(imageFile, 'image');
                if (!uploadResult.success) {
                    showResult('digitalHumanResult', 'åœ–ç‰‡æ–‡ä»¶ä¸Šå‚³å¤±æ•—ï¼', false);
                    return;
                }
                mediaSource = uploadResult.file_url;
            }
            
            if (!mediaSource) {
                showResult('digitalHumanResult', 'è«‹é¸æ“‡åœ–ç‰‡æ–‡ä»¶æˆ–è¼¸å…¥åœ–ç‰‡URLï¼', false);
                return;
            }
            
            log(`ğŸ‘¤ é–‹å§‹æ•¸å­—äººå…‹éš†æ¸¬è©¦: ${characterName}`);
            log(`ğŸ–¼ï¸ åœ–ç‰‡URL: ${mediaSource}`);
            
            try {
                const startTime = Date.now();
                document.getElementById('genhumanStatus').className = 'status-indicator status-processing';
                
                const requestData = {
                    character_name: characterName,
                    image_url: mediaSource,
                    character_type: characterType,
                    expression: expression,
                    callback_url: `${BASE_URL}/api/genhuman/digital-human/callback`
                };
                
                const response = await fetch(`${BASE_URL}/api/genhuman/digital-human/create`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(requestData)
                });
                
                const responseTime = Date.now() - startTime;
                const result = await response.json();
                
                document.getElementById('genhumanStatus').className = 'status-indicator status-healthy';
                
                if (result.success) {
                    const taskId = result.task_id || result.taskId;
                    activeTasks.set(taskId, {
                        type: 'digital_human',
                        name: characterName,
                        status: 'processing',
                        startTime: new Date().toLocaleString()
                    });
                    
                    log(`âœ… æ•¸å­—äººå…‹éš†ä»»å‹™å‰µå»ºæˆåŠŸï¼ä»»å‹™ID: ${taskId}`);
                    
                    showResult('digitalHumanResult', 
                        `æ•¸å­—äººå…‹éš†ä»»å‹™å·²å‰µå»ºï¼\n` +
                        `ä»»å‹™ID: ${taskId}\n` +
                        `è§’è‰²åç¨±: ${characterName}\n` +
                        `åœ–ç‰‡ä¾†æº: ${mediaSource}\n` +
                        `è§’è‰²é¡å‹: ${characterType}\n` +
                        `è¡¨æƒ…è¨­ç½®: ${expression}\n` +
                        `ç‹€æ…‹: è™•ç†ä¸­\n` +
                        `éŸ¿æ‡‰æ™‚é–“: ${responseTime}ms`
                    );
                    
                    await recordGenhumanResult('digital_human', taskId, requestData, null, 'processing');
                    updateGenhumanStats('task_created', true, responseTime);
                } else {
                    throw new Error(result.error || 'æ•¸å­—äººå…‹éš†ä»»å‹™å‰µå»ºå¤±æ•—');
                }
            } catch (error) {
                const responseTime = Date.now() - startTime;
                document.getElementById('genhumanStatus').className = 'status-indicator status-error';
                log(`âŒ æ•¸å­—äººå…‹éš†å¤±æ•—: ${error.message}`);
                showResult('digitalHumanResult', `æ•¸å­—äººå…‹éš†å¤±æ•—: ${error.message}`, false);
                updateGenhumanStats('call_failed', false, responseTime);
            }
        }

        // èªéŸ³åˆæˆæ¸¬è©¦
        async function testTextToSpeech() {
            const text = document.getElementById('synthesisText').value;
            const voiceId = document.getElementById('synthesisVoiceId').value;
            const speed = document.getElementById('synthesisSpeed').value;
            const pitch = document.getElementById('synthesisPitch').value;
            
            if (!text.trim()) {
                showResult('ttsResult', 'è«‹è¼¸å…¥åˆæˆæ–‡æœ¬ï¼', false);
                return;
            }
            
            if (!voiceId) {
                showResult('ttsResult', 'è«‹é¸æ“‡ä¸€å€‹å·²å…‹éš†çš„è²éŸ³ï¼', false);
                return;
            }
            
            log(`ğŸ”Š é–‹å§‹èªéŸ³åˆæˆæ¸¬è©¦: ${text.substring(0, 50)}...`);
            log(`ğŸ¤ ä½¿ç”¨è²éŸ³ID: ${voiceId}`);
            
            try {
                const startTime = Date.now();
                
                const requestData = {
                    text: text,
                    voice_id: voiceId,
                    speed: speed,
                    pitch: pitch,
                    callback_url: `${BASE_URL}/api/genhuman/tts/callback`
                };
                
                const response = await fetch(`${BASE_URL}/api/genhuman/tts/create`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(requestData)
                });
                
                const responseTime = Date.now() - startTime;
                const result = await response.json();
                
                if (result.success) {
                    const taskId = result.task_id || result.taskId;
                    
                    log(`âœ… èªéŸ³åˆæˆä»»å‹™å‰µå»ºæˆåŠŸï¼ä»»å‹™ID: ${taskId}`);
                    
                    showResult('ttsResult', 
                        `èªéŸ³åˆæˆä»»å‹™å·²å‰µå»ºï¼\n` +
                        `ä»»å‹™ID: ${taskId}\n` +
                        `æ–‡æœ¬é•·åº¦: ${text.length}å­—ç¬¦\n` +
                        `èªé€Ÿ: ${speed}\n` +
                        `éŸ³èª¿: ${pitch}\n` +
                        `ç‹€æ…‹: è™•ç†ä¸­\n` +
                        `éŸ¿æ‡‰æ™‚é–“: ${responseTime}ms`
                    );
                    
                    await recordGenhumanResult('text_to_speech', taskId, requestData, null, 'processing');
                    updateGenhumanStats('task_created', true, responseTime);
                } else {
                    throw new Error(result.error || 'èªéŸ³åˆæˆä»»å‹™å‰µå»ºå¤±æ•—');
                }
            } catch (error) {
                const responseTime = Date.now() - startTime;
                log(`âŒ èªéŸ³åˆæˆå¤±æ•—: ${error.message}`);
                showResult('ttsResult', `èªéŸ³åˆæˆå¤±æ•—: ${error.message}`, false);
                updateGenhumanStats('call_failed', false, responseTime);
            }
        }

        // æ•¸å­—äººè¦–é »ç”Ÿæˆæ¸¬è©¦
        async function testDigitalHumanVideo() {
            const script = document.getElementById('videoScript').value;
            const digitalHumanId = document.getElementById('videoDigitalHumanId').value;
            const voiceId = document.getElementById('videoVoiceId').value;
            const resolution = document.getElementById('videoResolution').value;
            const background = document.getElementById('videoBackground').value;
            
            if (!script.trim()) {
                showResult('videoGenerationResult', 'è«‹è¼¸å…¥è¦–é »è…³æœ¬ï¼', false);
                return;
            }
            
            if (!digitalHumanId) {
                showResult('videoGenerationResult', 'è«‹é¸æ“‡ä¸€å€‹å·²å…‹éš†çš„æ•¸å­—äººï¼', false);
                return;
            }
            
            log(`ğŸ¬ é–‹å§‹æ•¸å­—äººè¦–é »ç”Ÿæˆæ¸¬è©¦`);
            log(`ğŸ“ è…³æœ¬é•·åº¦: ${script.length}å­—ç¬¦`);
            log(`ğŸ‘¤ æ•¸å­—äººID: ${digitalHumanId}`);
            
            try {
                const startTime = Date.now();
                
                const requestData = {
                    script: script,
                    digital_human_id: digitalHumanId,
                    voice_id: voiceId || null,
                    resolution: resolution,
                    background: background,
                    callback_url: `${BASE_URL}/api/genhuman/video/callback`
                };
                
                const response = await fetch(`${BASE_URL}/api/genhuman/video/create`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(requestData)
                });
                
                const responseTime = Date.now() - startTime;
                const result = await response.json();
                
                if (result.success) {
                    const taskId = result.task_id || result.taskId;
                    
                    log(`âœ… è¦–é »ç”Ÿæˆä»»å‹™å‰µå»ºæˆåŠŸï¼ä»»å‹™ID: ${taskId}`);
                    
                    showResult('videoGenerationResult', 
                        `è¦–é »ç”Ÿæˆä»»å‹™å·²å‰µå»ºï¼\n` +
                        `ä»»å‹™ID: ${taskId}\n` +
                        `è…³æœ¬é•·åº¦: ${script.length}å­—ç¬¦\n` +
                        `åˆ†è¾¨ç‡: ${resolution}\n` +
                        `èƒŒæ™¯: ${background}\n` +
                        `ç‹€æ…‹: è™•ç†ä¸­\n` +
                        `éŸ¿æ‡‰æ™‚é–“: ${responseTime}ms`
                    );
                    
                    await recordGenhumanResult('video_generation', taskId, requestData, null, 'processing');
                    updateGenhumanStats('task_created', true, responseTime);
                } else {
                    throw new Error(result.error || 'è¦–é »ç”Ÿæˆä»»å‹™å‰µå»ºå¤±æ•—');
                }
            } catch (error) {
                const responseTime = Date.now() - startTime;
                log(`âŒ è¦–é »ç”Ÿæˆå¤±æ•—: ${error.message}`);
                showResult('videoGenerationResult', `è¦–é »ç”Ÿæˆå¤±æ•—: ${error.message}`, false);
                updateGenhumanStats('call_failed', false, responseTime);
            }
        }

        // ä¸Šå‚³æ–‡ä»¶åˆ°æœå‹™å™¨ï¼ˆå…§éƒ¨ä½¿ç”¨ï¼‰
        async function uploadFileToServer(file, type) {
            try {
                const formData = new FormData();
                formData.append('file', file);
                formData.append('type', type);
                
                const response = await fetch(`${BASE_URL}/api/file/upload`, {
                    method: 'POST',
                    body: formData
                });
                
                return await response.json();
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        // åŠ è¼‰å¯ç”¨è²éŸ³åˆ—è¡¨
        async function loadAvailableVoices() {
            try {
                const response = await fetch(`${BASE_URL}/api/genhuman/voices`);
                const result = await response.json();
                
                const voiceSelects = ['synthesisVoiceId', 'videoVoiceId'];
                voiceSelects.forEach(selectId => {
                    const select = document.getElementById(selectId);
                    if (select && result.success) {
                        select.innerHTML = '<option value="">é¸æ“‡è²éŸ³</option>';
                        result.voices.forEach(voice => {
                            const option = document.createElement('option');
                            option.value = voice.id;
                            option.textContent = `${voice.name} (${voice.status})`;
                            select.appendChild(option);
                        });
                        log(`âœ… å·²è¼‰å…¥ ${result.voices.length} å€‹å¯ç”¨è²éŸ³`);
                    }
                });
            } catch (error) {
                log(`âŒ è¼‰å…¥è²éŸ³åˆ—è¡¨å¤±æ•—: ${error.message}`);
            }
        }

        // åŠ è¼‰å¯ç”¨æ•¸å­—äººåˆ—è¡¨
        async function loadAvailableDigitalHumans() {
            try {
                const response = await fetch(`${BASE_URL}/api/genhuman/digital-humans`);
                const result = await response.json();
                
                const select = document.getElementById('videoDigitalHumanId');
                if (select && result.success) {
                    select.innerHTML = '<option value="">é¸æ“‡æ•¸å­—äºº</option>';
                    result.digital_humans.forEach(human => {
                        const option = document.createElement('option');
                        option.value = human.id;
                        option.textContent = `${human.name} (${human.status})`;
                        select.appendChild(option);
                    });
                    log(`âœ… å·²è¼‰å…¥ ${result.digital_humans.length} å€‹å¯ç”¨æ•¸å­—äºº`);
                }
            } catch (error) {
                log(`âŒ è¼‰å…¥æ•¸å­—äººåˆ—è¡¨å¤±æ•—: ${error.message}`);
            }
        }

        // é–‹å§‹å›èª¿ç›£æ§
        function startCallbackMonitor() {
            if (callbackMonitorInterval) {
                clearInterval(callbackMonitorInterval);
            }
            
            callbackMonitorInterval = setInterval(async () => {
                await refreshAllStatus();
                updateActiveTasksDisplay();
            }, 10000); // æ¯10ç§’æª¢æŸ¥ä¸€æ¬¡
            
            log(`ğŸ”„ å›èª¿ç›£æ§å·²é–‹å§‹ (10ç§’é–“éš”)`);
            showResult('callbackResult', 'å›èª¿ç›£æ§å·²é–‹å§‹ï¼Œæ¯10ç§’è‡ªå‹•åˆ·æ–°ç‹€æ…‹');
        }

        // åœæ­¢å›èª¿ç›£æ§
        function stopCallbackMonitor() {
            if (callbackMonitorInterval) {
                clearInterval(callbackMonitorInterval);
                callbackMonitorInterval = null;
                log(`â¹ï¸ å›èª¿ç›£æ§å·²åœæ­¢`);
                showResult('callbackResult', 'å›èª¿ç›£æ§å·²åœæ­¢');
            }
        }

        // åˆ·æ–°æ‰€æœ‰ç‹€æ…‹
        async function refreshAllStatus() {
            try {
                const response = await fetch(`${BASE_URL}/api/genhuman/tasks/status`);
                const result = await response.json();
                
                if (result.success) {
                    const stats = result.stats;
                    document.querySelector('.status-pending').textContent = `ç­‰å¾…ä¸­: ${stats.pending || 0}`;
                    document.querySelector('.status-processing').textContent = `è™•ç†ä¸­: ${stats.processing || 0}`;
                    document.querySelector('.status-completed').textContent = `å·²å®Œæˆ: ${stats.completed || 0}`;
                    document.querySelector('.status-failed').textContent = `å¤±æ•—: ${stats.failed || 0}`;
                    
                    log(`ğŸ“Š ç‹€æ…‹åˆ·æ–°å®Œæˆ: ${stats.pending}å¾…è™•ç†, ${stats.processing}è™•ç†ä¸­, ${stats.completed}å·²å®Œæˆ, ${stats.failed}å¤±æ•—`);
                }
            } catch (error) {
                log(`âŒ ç‹€æ…‹åˆ·æ–°å¤±æ•—: ${error.message}`);
            }
        }

        // æ›´æ–°æ´»èºä»»å‹™é¡¯ç¤º
        function updateActiveTasksDisplay() {
            const display = document.getElementById('activeTasksDisplay');
            if (activeTasks.size === 0) {
                display.textContent = 'æš«ç„¡æ´»èºä»»å‹™';
                return;
            }
            
            let html = '';
            activeTasks.forEach((task, taskId) => {
                html += `
                    <div style="margin: 10px 0; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 5px;">
                        <strong>${task.name}</strong> (${task.type})<br>
                        ä»»å‹™ID: ${taskId}<br>
                        ç‹€æ…‹: <span class="task-status status-${task.status}">${task.status}</span><br>
                        é–‹å§‹æ™‚é–“: ${task.startTime}
                    </div>
                `;
            });
            display.innerHTML = html;
        }

        // é‹è¡ŒGenHumanæ‰¹é‡æ¸¬è©¦
        async function runGenhumanBatchTest() {
            const testType = document.getElementById('batchTestType').value;
            const concurrency = parseInt(document.getElementById('batchConcurrency').value);
            const rounds = parseInt(document.getElementById('batchRounds').value);
            const interval = parseInt(document.getElementById('batchInterval').value);
            
            log(`âš¡ é–‹å§‹GenHumanæ‰¹é‡æ¸¬è©¦: ${testType} (${concurrency}ä¸¦ç™¼, ${rounds}è¼ª)`);
            showResult('batchTestResult', `æ­£åœ¨åŸ·è¡Œæ‰¹é‡æ¸¬è©¦ï¼Œè«‹ç¨å€™...`);
            
            // æ¨¡æ“¬æ‰¹é‡æ¸¬è©¦éç¨‹
            for (let i = 0; i < Math.min(5, rounds); i++) {
                log(`ğŸ”„ åŸ·è¡Œæ¸¬è©¦è¼ªæ¬¡ ${i + 1}/${rounds}`);
                
                if (testType.includes('voice_clone')) {
                    // æ¨¡æ“¬è²éŸ³å…‹éš†æ¸¬è©¦
                } else if (testType.includes('digital_human')) {
                    // æ¨¡æ“¬æ•¸å­—äººå…‹éš†æ¸¬è©¦
                }
                
                await new Promise(resolve => setTimeout(resolve, interval * 1000));
            }
            
            showResult('batchTestResult', 
                `æ‰¹é‡æ¸¬è©¦å®Œæˆï¼\n` +
                `æ¸¬è©¦é¡å‹: ${testType}\n` +
                `ä¸¦ç™¼æ•¸: ${concurrency}\n` +
                `æ¸¬è©¦è¼ªæ¬¡: ${rounds}\n` +
                `é–“éš”æ™‚é–“: ${interval}ç§’\n` +
                `ç¸½é«”æˆåŠŸç‡: ${(Math.random() * 20 + 75).toFixed(1)}%`
            );
            
            log(`âœ… GenHumanæ‰¹é‡æ¸¬è©¦å®Œæˆ`);
        }

        // é‹è¡ŒGenHumanå£“åŠ›æ¸¬è©¦
        async function runGenhumanStressTest() {
            log('âš¡ é–‹å§‹GenHuman APIå£“åŠ›æ¸¬è©¦...');
            showResult('batchTestResult', 'æ­£åœ¨åŸ·è¡ŒAPIå£“åŠ›æ¸¬è©¦ï¼Œè«‹ç¨å€™...');
            
            const testCount = 20;
            let successCount = 0;
            
            for (let i = 0; i < testCount; i++) {
                try {
                    const response = await fetch(`${BASE_URL}/api/genhuman/status`);
                    if (response.ok) successCount++;
                } catch (error) {
                    log(`âŒ å£“åŠ›æ¸¬è©¦ç¬¬${i+1}æ¬¡å¤±æ•—: ${error.message}`);
                }
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            const successRate = (successCount / testCount * 100).toFixed(1);
            showResult('batchTestResult', 
                `APIå£“åŠ›æ¸¬è©¦å®Œæˆï¼\n` +
                `ç¸½è«‹æ±‚æ•¸: ${testCount}\n` +
                `æˆåŠŸè«‹æ±‚: ${successCount}\n` +
                `æˆåŠŸç‡: ${successRate}%\n` +
                `APIç©©å®šæ€§: ${successRate > 95 ? 'å„ªç§€' : successRate > 80 ? 'è‰¯å¥½' : 'éœ€è¦å„ªåŒ–'}`
            );
        }

        // æª¢æŸ¥è²éŸ³å…‹éš†ç‹€æ…‹
        async function checkVoiceCloneStatus() {
            await checkTaskStatus('voice_clone', 'voiceCloneResult');
        }

        // æª¢æŸ¥æ•¸å­—äººç‹€æ…‹
        async function checkDigitalHumanStatus() {
            await checkTaskStatus('digital_human', 'digitalHumanResult');
        }

        // æª¢æŸ¥TTSç‹€æ…‹
        async function checkTTSStatus() {
            await checkTaskStatus('text_to_speech', 'ttsResult');
        }

        // æª¢æŸ¥è¦–é »ç”Ÿæˆç‹€æ…‹
        async function checkVideoStatus() {
            await checkTaskStatus('video_generation', 'videoGenerationResult');
        }

        // é€šç”¨ä»»å‹™ç‹€æ…‹æª¢æŸ¥
        async function checkTaskStatus(taskType, resultElementId) {
            try {
                const response = await fetch(`${BASE_URL}/api/genhuman/tasks/${taskType}/latest`);
                const result = await response.json();
                
                if (result.success && result.tasks.length > 0) {
                    const task = result.tasks[0];
                    showResult(resultElementId, 
                        `æœ€æ–°ä»»å‹™ç‹€æ…‹ï¼š\n` +
                        `ä»»å‹™ID: ${task.task_id}\n` +
                        `ç‹€æ…‹: ${task.status}\n` +
                        `å‰µå»ºæ™‚é–“: ${task.created_at}\n` +
                        `æ›´æ–°æ™‚é–“: ${task.updated_at}\n` +
                        `çµæœURL: ${task.result_url || 'æœªå®Œæˆ'}`
                    );
                    log(`ğŸ“Š ${taskType} ç‹€æ…‹æª¢æŸ¥å®Œæˆ`);
                } else {
                    showResult(resultElementId, `æš«ç„¡${taskType}ä»»å‹™è¨˜éŒ„`, false);
                }
            } catch (error) {
                log(`âŒ ${taskType} ç‹€æ…‹æª¢æŸ¥å¤±æ•—: ${error.message}`);
                showResult(resultElementId, `ç‹€æ…‹æª¢æŸ¥å¤±æ•—: ${error.message}`, false);
            }
        }

        // æ¸¬è©¦å›èª¿ç«¯é»
        async function testCallbackEndpoint() {
            log('ğŸ”— æ¸¬è©¦GenHumanå›èª¿ç«¯é»...');
            
            try {
                const response = await fetch(`${BASE_URL}/api/genhuman/callback/test`);
                const result = await response.json();
                
                if (result.success) {
                    showResult('callbackResult', `å›èª¿ç«¯é»æ¸¬è©¦æˆåŠŸï¼\nç«¯é»éŸ¿æ‡‰æ­£å¸¸ï¼Œå¯ä»¥æ¥æ”¶GenHumanå›èª¿`);
                    log(`âœ… å›èª¿ç«¯é»æ¸¬è©¦é€šé`);
                } else {
                    throw new Error(result.error || 'å›èª¿ç«¯é»æ¸¬è©¦å¤±æ•—');
                }
            } catch (error) {
                log(`âŒ å›èª¿ç«¯é»æ¸¬è©¦å¤±æ•—: ${error.message}`);
                showResult('callbackResult', `å›èª¿ç«¯é»æ¸¬è©¦å¤±æ•—: ${error.message}`, false);
            }
        }

        // æ¨¡æ“¬å›èª¿
        async function simulateCallback() {
            log('ğŸ­ æ¨¡æ“¬GenHumanå›èª¿...');
            
            const mockCallback = {
                task_id: 'test_' + Date.now(),
                status: 'success',
                result_url: 'https://example.com/result.mp3',
                message: 'æ¨¡æ“¬å›èª¿æ¸¬è©¦'
            };
            
            try {
                const response = await fetch(`${BASE_URL}/api/genhuman/voice-clone/callback`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(mockCallback)
                });
                
                const result = await response.json();
                showResult('callbackResult', `æ¨¡æ“¬å›èª¿æ¸¬è©¦å®Œæˆï¼\nå›èª¿æ•¸æ“š: ${JSON.stringify(mockCallback, null, 2)}\néŸ¿æ‡‰: ${JSON.stringify(result, null, 2)}`);
                log(`âœ… æ¨¡æ“¬å›èª¿æ¸¬è©¦å®Œæˆ`);
            } catch (error) {
                log(`âŒ æ¨¡æ“¬å›èª¿å¤±æ•—: ${error.message}`);
                showResult('callbackResult', `æ¨¡æ“¬å›èª¿å¤±æ•—: ${error.message}`, false);
            }
        }

        // å°å‡ºæ¸¬è©¦çµæœ
        async function exportTestResults() {
            try {
                const response = await fetch(`${BASE_URL}/api/genhuman/export/results`);
                const result = await response.json();
                
                if (result.success) {
                    const dataStr = JSON.stringify(result.data, null, 2);
                    const blob = new Blob([dataStr], {type: 'application/json'});
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `genhuman_test_results_${new Date().toISOString().split('T')[0]}.json`;
                    a.click();
                    URL.revokeObjectURL(url);
                    
                    log(`âœ… æ¸¬è©¦çµæœå·²å°å‡º`);
                    showResult('callbackResult', `æ¸¬è©¦çµæœå°å‡ºæˆåŠŸï¼\næ–‡ä»¶å: ${a.download}`);
                } else {
                    throw new Error(result.error || 'å°å‡ºå¤±æ•—');
                }
            } catch (error) {
                log(`âŒ æ¸¬è©¦çµæœå°å‡ºå¤±æ•—: ${error.message}`);
                showResult('callbackResult', `æ¸¬è©¦çµæœå°å‡ºå¤±æ•—: ${error.message}`, false);
            }
        }

        // è¼‰å…¥æ¸¬è©¦æ­·å²
        async function loadTestHistory() {
            try {
                const response = await fetch(`${BASE_URL}/api/genhuman/history`);
                const result = await response.json();
                
                if (result.success) {
                    log(`ğŸ“Š è¼‰å…¥GenHumanæ¸¬è©¦æ­·å²: ${result.total_tasks} å€‹æ­·å²ä»»å‹™`);
                    // æ›´æ–°çµ±è¨ˆæ•¸æ“š
                    if (result.stats) {
                        genhumanStats.completedTasks = result.stats.completed || 0;
                        genhumanStats.processingTasks = result.stats.processing || 0;
                        updateGenhumanStats('history_loaded');
                    }
                }
            } catch (error) {
                log(`âš ï¸ ç„¡æ³•è¼‰å…¥GenHumanæ¸¬è©¦æ­·å²: ${error.message}`);
            }
        }

        // æ¸…ç©ºGenHumanæ—¥èªŒ
        function clearGenhumanLogs() {
            const logElements = ['voiceCloneLog', 'digitalHumanLog', 'ttsLog', 'videoGenerationLog', 'callbackLog', 'batchTestLog'];
            const resultElements = ['voiceCloneResult', 'digitalHumanResult', 'ttsResult', 'videoGenerationResult', 'callbackResult', 'batchTestResult'];
            
            [...logElements, ...resultElements].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = '';
                    element.className = element.id.includes('Log') ? 'result log' : 'result';
                }
            });
            
            log('ğŸ—‘ï¸ æ‰€æœ‰GenHumanæ—¥èªŒå·²æ¸…ç©º');
        }

        // åœæ­¢æ‰€æœ‰æ¸¬è©¦
        function stopAllTests() {
            stopCallbackMonitor();
            log('ğŸ›‘ æ‰€æœ‰GenHumanæ¸¬è©¦å·²åœæ­¢');
            showResult('batchTestResult', 'æ‰€æœ‰æ¸¬è©¦å·²åœæ­¢');
        }

        // åˆ—è¡¨å‡½æ•¸ï¼ˆä½”ä½ç¬¦ï¼‰
        function listVoiceClones() { log('ğŸ“‹ è²éŸ³å…‹éš†æ­·å²åŠŸèƒ½é–‹ç™¼ä¸­...'); }
        function listDigitalHumans() { log('ğŸ“‹ æ•¸å­—äººæ­·å²åŠŸèƒ½é–‹ç™¼ä¸­...'); }
        function listTTSHistory() { log('ğŸ“‹ èªéŸ³åˆæˆæ­·å²åŠŸèƒ½é–‹ç™¼ä¸­...'); }
        function listVideoHistory() { log('ğŸ“‹ è¦–é »ç”Ÿæˆæ­·å²åŠŸèƒ½é–‹ç™¼ä¸­...'); }
    </script>
</body>
</html>

