<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FFMPEG é›²ç«¯æ¸¬è©¦ä¸­å¿ƒ</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            max-width: 1600px; 
            margin: 0 auto; 
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .header {
            background: rgba(255,255,255,0.95);
            color: #2c3e50;
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        .test-section { 
            background: rgba(255,255,255,0.95);
            padding: 30px; 
            border-radius: 20px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .test-section:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }
        .test-section h3 { 
            color: #2c3e50; 
            margin-top: 0; 
            border-bottom: 4px solid #e74c3c;
            padding-bottom: 15px;
            font-size: 1.4em;
        }
        .form-group { 
            margin: 20px 0; 
        }
        .form-group label { 
            display: block; 
            margin-bottom: 10px; 
            font-weight: 600;
            color: #34495e;
            font-size: 1.1em;
        }
        .form-group input, .form-group textarea, .form-group select { 
            width: 100%; 
            padding: 15px; 
            border: 3px solid #e1e8ed; 
            border-radius: 10px; 
            font-size: 15px;
            transition: all 0.3s ease;
        }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            border-color: #e74c3c;
            outline: none;
            box-shadow: 0 0 0 4px rgba(231, 76, 60, 0.1);
        }
        .btn { 
            padding: 15px 30px; 
            background: linear-gradient(135deg, #e74c3c, #c0392b); 
            color: white; 
            border: none; 
            border-radius: 10px; 
            cursor: pointer; 
            margin: 10px 8px; 
            font-weight: 600;
            font-size: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
        }
        .btn:hover { 
            background: linear-gradient(135deg, #c0392b, #a93226); 
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(231, 76, 60, 0.4);
        }
        .btn:disabled { 
            background: #bdc3c7; 
            cursor: not-allowed; 
            transform: none;
            box-shadow: none;
        }
        .btn-success { 
            background: linear-gradient(135deg, #27ae60, #2ecc71); 
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
        }
        .btn-success:hover { 
            background: linear-gradient(135deg, #229954, #27ae60); 
        }
        .btn-warning { 
            background: linear-gradient(135deg, #f39c12, #e67e22); 
            box-shadow: 0 5px 15px rgba(243, 156, 18, 0.3);
        }
        .btn-warning:hover { 
            background: linear-gradient(135deg, #e67e22, #d35400); 
        }
        .btn-info { 
            background: linear-gradient(135deg, #3498db, #2980b9); 
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }
        .btn-info:hover { 
            background: linear-gradient(135deg, #2980b9, #1abc9c); 
        }
        
        .result { 
            margin-top: 25px; 
            padding: 20px; 
            border-radius: 12px; 
            white-space: pre-wrap; 
            font-family: 'Courier New', monospace;
            font-size: 14px;
            border: 3px solid;
        }
        .success { 
            background: rgba(212, 244, 230, 0.9); 
            border-color: #27ae60; 
            color: #1e8449; 
        }
        .error { 
            background: rgba(250, 219, 216, 0.9); 
            border-color: #e74c3c; 
            color: #a93226; 
        }
        .log { 
            background: rgba(248, 249, 250, 0.9); 
            border-color: #dee2e6; 
            color: #495057; 
            max-height: 350px; 
            overflow-y: auto;
        }
        
        .stats-panel {
            background: rgba(255,255,255,0.95);
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
        }
        .stat-item {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .stat-number {
            font-size: 28px;
            font-weight: bold;
            color: #e74c3c;
        }
        .stat-label {
            font-size: 15px;
            color: #7f8c8d;
            margin-top: 8px;
        }
        
        .progress-bar {
            width: 100%;
            height: 25px;
            background: #ecf0f1;
            border-radius: 15px;
            overflow: hidden;
            margin: 15px 0;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #e74c3c, #c0392b);
            transition: width 0.5s ease;
        }
        
        .status-indicator {
            display: inline-block;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 10px;
        }
        .status-healthy { background: #27ae60; }
        .status-error { background: #e74c3c; }
        .status-testing { 
            background: #f39c12; 
            animation: ffmpeg-pulse 2s infinite; 
        }
        
        @keyframes ffmpeg-pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.1); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        .ffmpeg-logo {
            font-size: 3em;
            color: #e74c3c;
            margin-bottom: 15px;
        }
        
        .command-preview {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            border-left: 5px solid #e74c3c;
        }
        
        .file-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 5px solid #3498db;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="ffmpeg-logo">ğŸ¬</div>
        <h1>FFMPEG é›²ç«¯æ¸¬è©¦ä¸­å¿ƒ</h1>
        <p>ZEABURéƒ¨ç½²ç’°å¢ƒ | å°ˆæ¥­éŸ³è¦–é »è™•ç† | MySQLæ•¸æ“šæŒä¹…åŒ–</p>
        <div>
            <span class="status-indicator" id="ffmpegStatus"></span>
            <span id="ffmpegStatusText">æ­£åœ¨æª¢æŸ¥FFMPEGæœå‹™ç‹€æ…‹...</span>
        </div>
    </div>

    <!-- FFMPEGæ¸¬è©¦çµ±è¨ˆé¢æ¿ -->
    <div class="stats-panel">
        <h3>ğŸ“Š FFMPEG æ¸¬è©¦çµ±è¨ˆ</h3>
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-number" id="ffmpegTotalTests">0</div>
                <div class="stat-label">ç¸½è™•ç†æ•¸</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="ffmpegSuccessTests">0</div>
                <div class="stat-label">æˆåŠŸè™•ç†</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="ffmpegFailedTests">0</div>
                <div class="stat-label">è™•ç†å¤±æ•—</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="ffmpegAvgTime">0s</div>
                <div class="stat-label">å¹³å‡è™•ç†æ™‚é–“</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="ffmpegTotalSize">0MB</div>
                <div class="stat-label">ç´¯è¨ˆè™•ç†å¤§å°</div>
            </div>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" id="ffmpegSuccessRate" style="width: 0%"></div>
        </div>
        <div style="text-align: center; margin-top: 12px; font-size: 16px;">
            è™•ç†æˆåŠŸç‡: <span id="ffmpegSuccessRateText">0%</span>
        </div>
    </div>

    <!-- FFMPEGæ¸¬è©¦åŠŸèƒ½ç¶²æ ¼ -->
    <div class="test-grid">
        <!-- éŸ³é »è½‰æ›æ¸¬è©¦ -->
        <div class="test-section">
            <h3>ğŸµ éŸ³é »æ ¼å¼è½‰æ›</h3>
            
            <div class="form-group">
                <label>é¸æ“‡éŸ³é »æ–‡ä»¶ï¼š</label>
                <input type="file" id="audioFile" accept="audio/*">
                <div class="file-info" id="audioFileInfo" style="display:none;"></div>
            </div>
            
            <div class="form-group">
                <label>è¼¸å‡ºæ ¼å¼ï¼š</label>
                <select id="audioOutputFormat">
                    <option value="mp3">MP3 (æœ€å¸¸ç”¨)</option>
                    <option value="wav">WAV (ç„¡æ)</option>
                    <option value="aac">AAC (é«˜æ•ˆç‡)</option>
                    <option value="flac">FLAC (ç„¡æå£“ç¸®)</option>
                    <option value="ogg">OGG (é–‹æº)</option>
                    <option value="m4a">M4A (Apple)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>éŸ³é »è³ªé‡ï¼š</label>
                <select id="audioQuality">
                    <option value="320k">320kbps (æœ€é«˜è³ªé‡)</option>
                    <option value="256k">256kbps (é«˜è³ªé‡)</option>
                    <option value="192k">192kbps (æ¨™æº–è³ªé‡)</option>
                    <option value="128k">128kbps (åŸºæœ¬è³ªé‡)</option>
                    <option value="96k">96kbps (ä½è³ªé‡)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>æ¡æ¨£ç‡ï¼š</label>
                <select id="audioSampleRate">
                    <option value="48000">48kHz (å°ˆæ¥­)</option>
                    <option value="44100">44.1kHz (CDè³ªé‡)</option>
                    <option value="22050">22kHz (èªéŸ³)</option>
                    <option value="16000">16kHz (é›»è©±)</option>
                </select>
            </div>
            
            <div class="command-preview" id="audioCommand">FFmpegå‘½ä»¤é è¦½å°‡åœ¨é€™è£¡é¡¯ç¤º</div>
            
            <button class="btn" onclick="testAudioConvert()">ğŸ”„ é–‹å§‹éŸ³é »è½‰æ›</button>
            <button class="btn btn-info" onclick="previewAudioCommand()">ğŸ‘ï¸ é è¦½å‘½ä»¤</button>
            
            <div id="audioConvertResult" class="result"></div>
            <div id="audioConvertLog" class="result log"></div>
        </div>

        <!-- è¦–é »è½‰æ›æ¸¬è©¦ -->
        <div class="test-section">
            <h3>ğŸ¬ è¦–é »æ ¼å¼è½‰æ›</h3>
            
            <div class="form-group">
                <label>é¸æ“‡è¦–é »æ–‡ä»¶ï¼š</label>
                <input type="file" id="videoFile" accept="video/*">
                <div class="file-info" id="videoFileInfo" style="display:none;"></div>
            </div>
            
            <div class="form-group">
                <label>è¼¸å‡ºæ ¼å¼ï¼š</label>
                <select id="videoOutputFormat">
                    <option value="mp4">MP4 (æœ€é€šç”¨)</option>
                    <option value="avi">AVI (ç¶“å…¸æ ¼å¼)</option>
                    <option value="mov">MOV (QuickTime)</option>
                    <option value="mkv">MKV (è¬èƒ½å®¹å™¨)</option>
                    <option value="webm">WebM (ç¶²é å„ªåŒ–)</option>
                    <option value="flv">FLV (Flash)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>è¦–é »ç·¨ç¢¼ï¼š</label>
                <select id="videoCodec">
                    <option value="h264">H.264 (æœ€å…¼å®¹)</option>
                    <option value="h265">H.265 (é«˜æ•ˆç‡)</option>
                    <option value="vp9">VP9 (é–‹æº)</option>
                    <option value="av1">AV1 (æ¬¡ä¸–ä»£)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>åˆ†è¾¨ç‡ï¼š</label>
                <select id="videoResolution">
                    <option value="original">åŸå§‹åˆ†è¾¨ç‡</option>
                    <option value="4k">4K (3840x2160)</option>
                    <option value="1080p">1080p (1920x1080)</option>
                    <option value="720p">720p (1280x720)</option>
                    <option value="480p">480p (854x480)</option>
                    <option value="360p">360p (640x360)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>è¦–é »è³ªé‡ï¼š</label>
                <select id="videoQuality">
                    <option value="high">é«˜è³ªé‡ (CRF 18)</option>
                    <option value="medium">ä¸­ç­‰è³ªé‡ (CRF 23)</option>
                    <option value="low">ä½è³ªé‡ (CRF 28)</option>
                    <option value="custom">è‡ªå®šç¾©</option>
                </select>
            </div>
            
            <div class="command-preview" id="videoCommand">FFmpegå‘½ä»¤é è¦½å°‡åœ¨é€™è£¡é¡¯ç¤º</div>
            
            <button class="btn" onclick="testVideoConvert()">ğŸ¥ é–‹å§‹è¦–é »è½‰æ›</button>
            <button class="btn btn-info" onclick="previewVideoCommand()">ğŸ‘ï¸ é è¦½å‘½ä»¤</button>
            
            <div id="videoConvertResult" class="result"></div>
            <div id="videoConvertLog" class="result log"></div>
        </div>

        <!-- è¦–é »å‰ªåˆ‡æ¸¬è©¦ -->
        <div class="test-section">
            <h3>âœ‚ï¸ è¦–é »å‰ªåˆ‡è™•ç†</h3>
            
            <div class="form-group">
                <label>è¦–é »æ–‡ä»¶ï¼š</label>
                <input type="file" id="trimVideoFile" accept="video/*">
            </div>
            
            <div class="form-group">
                <label>é–‹å§‹æ™‚é–“ (HH:MM:SS)ï¼š</label>
                <input type="text" id="trimStartTime" placeholder="00:00:30" value="00:00:00">
            </div>
            
            <div class="form-group">
                <label>çµæŸæ™‚é–“ (HH:MM:SS)ï¼š</label>
                <input type="text" id="trimEndTime" placeholder="00:01:30" value="00:00:10">
            </div>
            
            <div class="form-group">
                <label>æˆ–è€…æŒ‡å®šæ™‚é•· (ç§’)ï¼š</label>
                <input type="number" id="trimDuration" placeholder="60" min="1">
            </div>
            
            <div class="form-group">
                <label>å‰ªåˆ‡æ¨¡å¼ï¼š</label>
                <select id="trimMode">
                    <option value="fast">å¿«é€Ÿå‰ªåˆ‡ (stream copy)</option>
                    <option value="precise">ç²¾ç¢ºå‰ªåˆ‡ (re-encode)</option>
                </select>
            </div>
            
            <div class="command-preview" id="trimCommand">FFmpegå‘½ä»¤é è¦½å°‡åœ¨é€™è£¡é¡¯ç¤º</div>
            
            <button class="btn" onclick="testVideoTrim()">âœ‚ï¸ é–‹å§‹è¦–é »å‰ªåˆ‡</button>
            <button class="btn btn-info" onclick="previewTrimCommand()">ğŸ‘ï¸ é è¦½å‘½ä»¤</button>
            
            <div id="trimResult" class="result"></div>
            <div id="trimLog" class="result log"></div>
        </div>

        <!-- éŸ³é »æå–æ¸¬è©¦ -->
        <div class="test-section">
            <h3>ğŸµ éŸ³é »æå–è™•ç†</h3>
            
            <div class="form-group">
                <label>è¦–é »æ–‡ä»¶ï¼š</label>
                <input type="file" id="extractVideoFile" accept="video/*">
            </div>
            
            <div class="form-group">
                <label>éŸ³é »æ ¼å¼ï¼š</label>
                <select id="extractAudioFormat">
                    <option value="mp3">MP3</option>
                    <option value="wav">WAV</option>
                    <option value="aac">AAC</option>
                    <option value="flac">FLAC</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>éŸ³é »è³ªé‡ï¼š</label>
                <select id="extractQuality">
                    <option value="320k">320kbps</option>
                    <option value="256k">256kbps</option>
                    <option value="192k">192kbps</option>
                    <option value="128k">128kbps</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>è™•ç†ç¯„åœï¼š</label>
                <select id="extractRange">
                    <option value="full">å®Œæ•´éŸ³é »</option>
                    <option value="partial">éƒ¨åˆ†æå–</option>
                </select>
            </div>
            
            <div class="command-preview" id="extractCommand">FFmpegå‘½ä»¤é è¦½å°‡åœ¨é€™è£¡é¡¯ç¤º</div>
            
            <button class="btn" onclick="testAudioExtract()">ğŸµ é–‹å§‹éŸ³é »æå–</button>
            <button class="btn btn-info" onclick="previewExtractCommand()">ğŸ‘ï¸ é è¦½å‘½ä»¤</button>
            
            <div id="extractResult" class="result"></div>
            <div id="extractLog" class="result log"></div>
        </div>

        <!-- ç¸®ç•¥åœ–ç”Ÿæˆæ¸¬è©¦ -->
        <div class="test-section">
            <h3>ğŸ“¸ ç¸®ç•¥åœ–ç”Ÿæˆ</h3>
            
            <div class="form-group">
                <label>è¦–é »æ–‡ä»¶ï¼š</label>
                <input type="file" id="thumbVideoFile" accept="video/*">
            </div>
            
            <div class="form-group">
                <label>æˆªåœ–æ™‚é–“é» (HH:MM:SS)ï¼š</label>
                <input type="text" id="thumbTime" placeholder="00:00:10" value="00:00:05">
            </div>
            
            <div class="form-group">
                <label>ç¸®ç•¥åœ–å°ºå¯¸ï¼š</label>
                <select id="thumbSize">
                    <option value="320x240">320x240 (å°)</option>
                    <option value="640x480">640x480 (ä¸­)</option>
                    <option value="800x600">800x600 (å¤§)</option>
                    <option value="1280x720">1280x720 (HD)</option>
                    <option value="original">åŸå§‹å°ºå¯¸</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>åœ–ç‰‡æ ¼å¼ï¼š</label>
                <select id="thumbFormat">
                    <option value="jpg">JPEG</option>
                    <option value="png">PNG</option>
                    <option value="webp">WebP</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>ç”Ÿæˆæ•¸é‡ï¼š</label>
                <select id="thumbCount">
                    <option value="1">å–®å¼µæˆªåœ–</option>
                    <option value="3">3å¼µå‡å‹»åˆ†å¸ƒ</option>
                    <option value="5">5å¼µå‡å‹»åˆ†å¸ƒ</option>
                    <option value="10">10å¼µå‡å‹»åˆ†å¸ƒ</option>
                </select>
            </div>
            
            <div class="command-preview" id="thumbCommand">FFmpegå‘½ä»¤é è¦½å°‡åœ¨é€™è£¡é¡¯ç¤º</div>
            
            <button class="btn" onclick="testThumbnailGenerate()">ğŸ“¸ ç”Ÿæˆç¸®ç•¥åœ–</button>
            <button class="btn btn-info" onclick="previewThumbCommand()">ğŸ‘ï¸ é è¦½å‘½ä»¤</button>
            
            <div id="thumbResult" class="result"></div>
            <div id="thumbLog" class="result log"></div>
        </div>

        <!-- æ‰¹é‡è™•ç†é¢æ¿ -->
        <div class="test-section">
            <h3>âš¡ FFMPEG æ‰¹é‡è™•ç†</h3>
            
            <div class="form-group">
                <label>æ‰¹é‡è™•ç†ä»»å‹™ï¼š</label>
                <select id="batchTask">
                    <option value="format_conversion">æ ¼å¼æ‰¹é‡è½‰æ›</option>
                    <option value="resolution_batch">æ‰¹é‡èª¿æ•´åˆ†è¾¨ç‡</option>
                    <option value="audio_extraction">æ‰¹é‡éŸ³é »æå–</option>
                    <option value="thumbnail_batch">æ‰¹é‡ç¸®ç•¥åœ–ç”Ÿæˆ</option>
                    <option value="quality_optimization">æ‰¹é‡è³ªé‡å„ªåŒ–</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>ä¸¦ç™¼è™•ç†æ•¸ï¼š</label>
                <select id="batchConcurrency">
                    <option value="1">å–®å€‹è™•ç†</option>
                    <option value="2">2å€‹ä¸¦ç™¼</option>
                    <option value="3">3å€‹ä¸¦ç™¼</option>
                    <option value="5">5å€‹ä¸¦ç™¼</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>æ¸¬è©¦æ–‡ä»¶æ•¸é‡ï¼š</label>
                <select id="batchFileCount">
                    <option value="5">5å€‹æ–‡ä»¶</option>
                    <option value="10">10å€‹æ–‡ä»¶</option>
                    <option value="20">20å€‹æ–‡ä»¶</option>
                    <option value="50">50å€‹æ–‡ä»¶</option>
                </select>
            </div>
            
            <button class="btn btn-success" onclick="runFFmpegBatchTest()">ğŸš€ é‹è¡Œæ‰¹é‡æ¸¬è©¦</button>
            <button class="btn btn-warning" onclick="runFFmpegStressTest()">âš¡ FFMPEGå£“åŠ›æ¸¬è©¦</button>
            <button class="btn btn-info" onclick="checkFFmpegInfo()">â„¹ï¸ æª¢æŸ¥FFMPEGä¿¡æ¯</button>
            <button class="btn" onclick="clearFFmpegLogs()">ğŸ—‘ï¸ æ¸…ç©ºæ—¥èªŒ</button>
            
            <div id="ffmpegBatchResult" class="result"></div>
            <div id="ffmpegBatchLog" class="result log"></div>
        </div>
    </div>

    <script>
        // å…¨å±€è®Šé‡
        const BASE_URL = 'https://vidsparkback.zeabur.app';
        let ffmpegStats = {
            total: 0,
            success: 0,
            failed: 0,
            times: [],
            totalSize: 0
        };

        // åˆå§‹åŒ–é é¢
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸš€ FFMPEG é›²ç«¯æ¸¬è©¦ä¸­å¿ƒå·²åŠ è¼‰');
            log('ğŸŒ æ¸¬è©¦ç’°å¢ƒ: ' + BASE_URL);
            checkFFmpegStatus();
            setupFileInfoListeners();
        });

        // è¨­ç½®æ–‡ä»¶ä¿¡æ¯ç›£è½å™¨
        function setupFileInfoListeners() {
            const fileInputs = ['audioFile', 'videoFile', 'trimVideoFile', 'extractVideoFile', 'thumbVideoFile'];
            
            fileInputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                if (input) {
                    input.addEventListener('change', function(e) {
                        const file = e.target.files[0];
                        const infoId = inputId + 'Info';
                        const infoElement = document.getElementById(infoId);
                        
                        if (file && infoElement) {
                            infoElement.style.display = 'block';
                            infoElement.innerHTML = `
                                <strong>æ–‡ä»¶ä¿¡æ¯ï¼š</strong><br>
                                åç¨±: ${file.name}<br>
                                å¤§å°: ${(file.size / 1024 / 1024).toFixed(2)} MB<br>
                                é¡å‹: ${file.type}<br>
                                æœ€å¾Œä¿®æ”¹: ${new Date(file.lastModified).toLocaleString()}
                            `;
                        }
                    });
                }
            });
        }

        // é€šç”¨æ—¥èªŒå‡½æ•¸
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}`;
            
            console.log(`[FFMPEG Cloud Test] ${message}`);
            
            // è¼¸å‡ºåˆ°å„å€‹æ—¥èªŒå€åŸŸ
            const logElements = ['audioConvertLog', 'videoConvertLog', 'trimLog', 'extractLog', 'thumbLog', 'ffmpegBatchLog'];
            logElements.forEach(logId => {
                const element = document.getElementById(logId);
                if (element) {
                    element.textContent += logMessage + '\n';
                    element.scrollTop = element.scrollHeight;
                }
            });
        }

        // é¡¯ç¤ºçµæœ
        function showResult(elementId, message, isSuccess = true) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = message;
                element.className = isSuccess ? 'result success' : 'result error';
            }
        }

        // æ›´æ–°FFMPEGçµ±è¨ˆ
        function updateFFmpegStats(success, responseTime, fileSize = 0) {
            ffmpegStats.total++;
            if (success) ffmpegStats.success++;
            else ffmpegStats.failed++;
            ffmpegStats.times.push(responseTime);
            ffmpegStats.totalSize += fileSize;

            // æ›´æ–°é¡¯ç¤º
            document.getElementById('ffmpegTotalTests').textContent = ffmpegStats.total;
            document.getElementById('ffmpegSuccessTests').textContent = ffmpegStats.success;
            document.getElementById('ffmpegFailedTests').textContent = ffmpegStats.failed;
            
            const avgTime = ffmpegStats.times.reduce((a, b) => a + b, 0) / ffmpegStats.times.length;
            document.getElementById('ffmpegAvgTime').textContent = (avgTime / 1000).toFixed(1) + 's';
            
            document.getElementById('ffmpegTotalSize').textContent = (ffmpegStats.totalSize / 1024 / 1024).toFixed(1) + 'MB';
            
            const successRate = ffmpegStats.total > 0 ? (ffmpegStats.success / ffmpegStats.total * 100) : 0;
            document.getElementById('ffmpegSuccessRate').style.width = successRate + '%';
            document.getElementById('ffmpegSuccessRateText').textContent = successRate.toFixed(1) + '%';
        }

        // æª¢æŸ¥FFMPEGç‹€æ…‹
        async function checkFFmpegStatus() {
            try {
                const startTime = Date.now();
                const response = await fetch(`${BASE_URL}/api/ffmpeg/info`);
                const responseTime = Date.now() - startTime;
                
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('ffmpegStatus').className = 'status-indicator status-healthy';
                    document.getElementById('ffmpegStatusText').textContent = `FFMPEGæœå‹™æ­£å¸¸ (${responseTime}ms)`;
                    log(`âœ… FFMPEGæœå‹™æª¢æŸ¥é€šé: ç‰ˆæœ¬ ${data.version || 'unknown'}`);
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                document.getElementById('ffmpegStatus').className = 'status-indicator status-error';
                document.getElementById('ffmpegStatusText').textContent = 'FFMPEGæœå‹™ç•°å¸¸';
                log(`âŒ FFMPEGæœå‹™æª¢æŸ¥å¤±æ•—: ${error.message}`);
            }
        }

        // éŸ³é »è½‰æ›å‘½ä»¤é è¦½
        function previewAudioCommand() {
            const format = document.getElementById('audioOutputFormat').value;
            const quality = document.getElementById('audioQuality').value;
            const sampleRate = document.getElementById('audioSampleRate').value;
            
            const command = `ffmpeg -i input.audio -acodec ${getAudioCodec(format)} -b:a ${quality} -ar ${sampleRate} output.${format}`;
            document.getElementById('audioCommand').textContent = command;
            log(`ğŸ” éŸ³é »è½‰æ›å‘½ä»¤é è¦½: ${command}`);
        }

        // è¦–é »è½‰æ›å‘½ä»¤é è¦½
        function previewVideoCommand() {
            const format = document.getElementById('videoOutputFormat').value;
            const codec = document.getElementById('videoCodec').value;
            const resolution = document.getElementById('videoResolution').value;
            const quality = document.getElementById('videoQuality').value;
            
            let resolutionParam = '';
            if (resolution !== 'original') {
                const resMap = {
                    '4k': '3840x2160',
                    '1080p': '1920x1080',
                    '720p': '1280x720',
                    '480p': '854x480',
                    '360p': '640x360'
                };
                resolutionParam = ` -s ${resMap[resolution]}`;
            }
            
            const qualityParam = quality === 'custom' ? '' : ` -crf ${getQualityCRF(quality)}`;
            const command = `ffmpeg -i input.video -vcodec ${codec}${resolutionParam}${qualityParam} output.${format}`;
            document.getElementById('videoCommand').textContent = command;
            log(`ğŸ” è¦–é »è½‰æ›å‘½ä»¤é è¦½: ${command}`);
        }

        // å‰ªåˆ‡å‘½ä»¤é è¦½
        function previewTrimCommand() {
            const startTime = document.getElementById('trimStartTime').value;
            const endTime = document.getElementById('trimEndTime').value;
            const duration = document.getElementById('trimDuration').value;
            const mode = document.getElementById('trimMode').value;
            
            let timeParam = '';
            if (duration) {
                timeParam = ` -ss ${startTime} -t ${duration}`;
            } else {
                timeParam = ` -ss ${startTime} -to ${endTime}`;
            }
            
            const copyParam = mode === 'fast' ? ' -c copy' : '';
            const command = `ffmpeg -i input.video${timeParam}${copyParam} output.mp4`;
            document.getElementById('trimCommand').textContent = command;
            log(`ğŸ” è¦–é »å‰ªåˆ‡å‘½ä»¤é è¦½: ${command}`);
        }

        // éŸ³é »æå–å‘½ä»¤é è¦½
        function previewExtractCommand() {
            const format = document.getElementById('extractAudioFormat').value;
            const quality = document.getElementById('extractQuality').value;
            
            const command = `ffmpeg -i input.video -vn -acodec ${getAudioCodec(format)} -b:a ${quality} output.${format}`;
            document.getElementById('extractCommand').textContent = command;
            log(`ğŸ” éŸ³é »æå–å‘½ä»¤é è¦½: ${command}`);
        }

        // ç¸®ç•¥åœ–å‘½ä»¤é è¦½
        function previewThumbCommand() {
            const time = document.getElementById('thumbTime').value;
            const size = document.getElementById('thumbSize').value;
            const format = document.getElementById('thumbFormat').value;
            const count = document.getElementById('thumbCount').value;
            
            let sizeParam = size === 'original' ? '' : ` -s ${size}`;
            
            if (count === '1') {
                const command = `ffmpeg -i input.video -ss ${time} -vframes 1${sizeParam} output.${format}`;
                document.getElementById('thumbCommand').textContent = command;
            } else {
                const command = `ffmpeg -i input.video -vf "select=not(mod(n\\,${Math.floor(100/count)}))" -vsync vfr${sizeParam} output_%03d.${format}`;
                document.getElementById('thumbCommand').textContent = command;
            }
        }

        // ç²å–éŸ³é »ç·¨ç¢¼å™¨
        function getAudioCodec(format) {
            const codecs = {
                'mp3': 'libmp3lame',
                'aac': 'aac',
                'wav': 'pcm_s16le',
                'flac': 'flac',
                'ogg': 'libvorbis'
            };
            return codecs[format] || 'aac';
        }

        // ç²å–è³ªé‡CRFå€¼
        function getQualityCRF(quality) {
            const crfMap = {
                'high': '18',
                'medium': '23',
                'low': '28'
            };
            return crfMap[quality] || '23';
        }

        // è¨˜éŒ„FFMPEGè™•ç†çµæœåˆ°æ•¸æ“šåº«
        async function recordFFmpegResult(operationType, inputFile, outputUrl, command, processingTime, fileSizeBefore, fileSizeAfter, status, errorMessage = null) {
            try {
                const response = await fetch(`${BASE_URL}/api/test/ffmpeg/record`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        operation_type: operationType,
                        input_file_url: inputFile,
                        output_file_url: outputUrl,
                        ffmpeg_command: command,
                        processing_time_seconds: processingTime / 1000,
                        file_size_before: fileSizeBefore,
                        file_size_after: fileSizeAfter,
                        test_status: status,
                        error_message: errorMessage
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    log(`ğŸ’¾ FFMPEGè™•ç†çµæœå·²ä¿å­˜åˆ°æ•¸æ“šåº«: è¨˜éŒ„ID ${result.record_id}`);
                }
            } catch (error) {
                log(`âŒ FFMPEGçµæœä¿å­˜å¤±æ•—: ${error.message}`);
            }
        }

        // éŸ³é »è½‰æ›æ¸¬è©¦
        async function testAudioConvert() {
            const fileInput = document.getElementById('audioFile');
            const format = document.getElementById('audioOutputFormat').value;
            const quality = document.getElementById('audioQuality').value;
            const sampleRate = document.getElementById('audioSampleRate').value;
            
            if (!fileInput.files[0]) {
                showResult('audioConvertResult', 'è«‹å…ˆé¸æ“‡éŸ³é »æ–‡ä»¶ï¼', false);
                return;
            }
            
            const file = fileInput.files[0];
            log(`ğŸµ é–‹å§‹éŸ³é »è½‰æ›æ¸¬è©¦: ${file.name} -> ${format}`);
            log(`ğŸ“Š æ–‡ä»¶å¤§å°: ${(file.size / 1024 / 1024).toFixed(2)} MB`);
            
            try {
                const startTime = Date.now();
                const formData = new FormData();
                formData.append('audio', file);
                formData.append('output_format', format);
                formData.append('quality', quality);
                formData.append('sample_rate', sampleRate);
                
                document.getElementById('ffmpegStatus').className = 'status-indicator status-testing';
                
                const response = await fetch(`${BASE_URL}/api/ffmpeg/audio/convert`, {
                    method: 'POST',
                    body: formData
                });
                
                const responseTime = Date.now() - startTime;
                const result = await response.json();
                
                document.getElementById('ffmpegStatus').className = 'status-indicator status-healthy';
                
                if (result.success) {
                    log(`âœ… éŸ³é »è½‰æ›æˆåŠŸï¼ç”¨æ™‚: ${(responseTime/1000).toFixed(2)}s`);
                    log(`ğŸ”— è¼¸å‡ºæ–‡ä»¶: ${result.output_url}`);
                    log(`ğŸ“Š è¼¸å‡ºå¤§å°: ${result.file_size ? (result.file_size / 1024 / 1024).toFixed(2) + ' MB' : 'æœªçŸ¥'}`);
                    
                    showResult('audioConvertResult', 
                        `è½‰æ›æˆåŠŸï¼\n` +
                        `è¼¸å…¥æ ¼å¼: ${file.type}\n` +
                        `è¼¸å‡ºæ ¼å¼: ${format}\n` +
                        `éŸ³é »è³ªé‡: ${quality}\n` +
                        `æ¡æ¨£ç‡: ${sampleRate}Hz\n` +
                        `è™•ç†æ™‚é–“: ${(responseTime/1000).toFixed(2)}s\n` +
                        `æ–‡ä»¶URL: ${result.output_url}`
                    );
                    
                    await recordFFmpegResult('audio_convert', file.name, result.output_url, 
                        result.ffmpeg_command, responseTime, file.size, result.file_size, 'success');
                    updateFFmpegStats(true, responseTime, file.size);
                } else {
                    throw new Error(result.error || 'è½‰æ›å¤±æ•—');
                }
            } catch (error) {
                const responseTime = Date.now() - startTime;
                document.getElementById('ffmpegStatus').className = 'status-indicator status-error';
                log(`âŒ éŸ³é »è½‰æ›å¤±æ•—: ${error.message}`);
                showResult('audioConvertResult', `è½‰æ›å¤±æ•—: ${error.message}`, false);
                
                await recordFFmpegResult('audio_convert', file.name, null, null, responseTime, file.size, 0, 'failed', error.message);
                updateFFmpegStats(false, responseTime, file.size);
            }
        }

        // è¦–é »è½‰æ›æ¸¬è©¦
        async function testVideoConvert() {
            const fileInput = document.getElementById('videoFile');
            const format = document.getElementById('videoOutputFormat').value;
            const codec = document.getElementById('videoCodec').value;
            const resolution = document.getElementById('videoResolution').value;
            const quality = document.getElementById('videoQuality').value;
            
            if (!fileInput.files[0]) {
                showResult('videoConvertResult', 'è«‹å…ˆé¸æ“‡è¦–é »æ–‡ä»¶ï¼', false);
                return;
            }
            
            const file = fileInput.files[0];
            log(`ğŸ¬ é–‹å§‹è¦–é »è½‰æ›æ¸¬è©¦: ${file.name} -> ${format}`);
            log(`ğŸ“Š æ–‡ä»¶å¤§å°: ${(file.size / 1024 / 1024).toFixed(2)} MB`);
            
            try {
                const startTime = Date.now();
                const formData = new FormData();
                formData.append('video', file);
                formData.append('output_format', format);
                formData.append('codec', codec);
                formData.append('resolution', resolution);
                formData.append('quality', quality);
                
                document.getElementById('ffmpegStatus').className = 'status-indicator status-testing';
                
                const response = await fetch(`${BASE_URL}/api/ffmpeg/video/convert`, {
                    method: 'POST',
                    body: formData
                });
                
                const responseTime = Date.now() - startTime;
                const result = await response.json();
                
                document.getElementById('ffmpegStatus').className = 'status-indicator status-healthy';
                
                if (result.success) {
                    log(`âœ… è¦–é »è½‰æ›æˆåŠŸï¼ç”¨æ™‚: ${(responseTime/1000).toFixed(2)}s`);
                    log(`ğŸ”— è¼¸å‡ºæ–‡ä»¶: ${result.output_url}`);
                    
                    showResult('videoConvertResult', 
                        `è½‰æ›æˆåŠŸï¼\n` +
                        `è¼¸å‡ºæ ¼å¼: ${format}\n` +
                        `è¦–é »ç·¨ç¢¼: ${codec}\n` +
                        `åˆ†è¾¨ç‡: ${resolution}\n` +
                        `è³ªé‡è¨­ç½®: ${quality}\n` +
                        `è™•ç†æ™‚é–“: ${(responseTime/1000).toFixed(2)}s\n` +
                        `æ–‡ä»¶URL: ${result.output_url}`
                    );
                    
                    await recordFFmpegResult('video_convert', file.name, result.output_url, 
                        result.ffmpeg_command, responseTime, file.size, result.file_size, 'success');
                    updateFFmpegStats(true, responseTime, file.size);
                } else {
                    throw new Error(result.error || 'è½‰æ›å¤±æ•—');
                }
            } catch (error) {
                const responseTime = Date.now() - startTime;
                document.getElementById('ffmpegStatus').className = 'status-indicator status-error';
                log(`âŒ è¦–é »è½‰æ›å¤±æ•—: ${error.message}`);
                showResult('videoConvertResult', `è½‰æ›å¤±æ•—: ${error.message}`, false);
                
                await recordFFmpegResult('video_convert', file.name, null, null, responseTime, file.size, 0, 'failed', error.message);
                updateFFmpegStats(false, responseTime, file.size);
            }
        }

        // è¦–é »å‰ªåˆ‡æ¸¬è©¦
        async function testVideoTrim() {
            const fileInput = document.getElementById('trimVideoFile');
            const startTime = document.getElementById('trimStartTime').value;
            const endTime = document.getElementById('trimEndTime').value;
            const duration = document.getElementById('trimDuration').value;
            const mode = document.getElementById('trimMode').value;
            
            if (!fileInput.files[0]) {
                showResult('trimResult', 'è«‹å…ˆé¸æ“‡è¦–é »æ–‡ä»¶ï¼', false);
                return;
            }
            
            const file = fileInput.files[0];
            log(`âœ‚ï¸ é–‹å§‹è¦–é »å‰ªåˆ‡æ¸¬è©¦: ${file.name}`);
            log(`â° æ™‚é–“ç¯„åœ: ${startTime} - ${endTime || duration + 's'}`);
            
            try {
                const requestStartTime = Date.now();
                const formData = new FormData();
                formData.append('video', file);
                formData.append('start_time', startTime);
                if (duration) {
                    formData.append('duration', duration);
                } else {
                    formData.append('end_time', endTime);
                }
                formData.append('mode', mode);
                
                const response = await fetch(`${BASE_URL}/api/ffmpeg/video/trim`, {
                    method: 'POST',
                    body: formData
                });
                
                const responseTime = Date.now() - requestStartTime;
                const result = await response.json();
                
                if (result.success) {
                    log(`âœ… è¦–é »å‰ªåˆ‡æˆåŠŸï¼ç”¨æ™‚: ${(responseTime/1000).toFixed(2)}s`);
                    showResult('trimResult', 
                        `å‰ªåˆ‡æˆåŠŸï¼\n` +
                        `åŸå§‹æ™‚é•·: ${result.original_duration || 'æœªçŸ¥'}\n` +
                        `å‰ªåˆ‡ç¯„åœ: ${startTime} - ${endTime || duration + 's'}\n` +
                        `å‰ªåˆ‡æ¨¡å¼: ${mode}\n` +
                        `è™•ç†æ™‚é–“: ${(responseTime/1000).toFixed(2)}s\n` +
                        `æ–‡ä»¶URL: ${result.output_url}`
                    );
                    
                    await recordFFmpegResult('video_trim', file.name, result.output_url, 
                        result.ffmpeg_command, responseTime, file.size, result.file_size, 'success');
                    updateFFmpegStats(true, responseTime, file.size);
                } else {
                    throw new Error(result.error || 'å‰ªåˆ‡å¤±æ•—');
                }
            } catch (error) {
                const responseTime = Date.now() - requestStartTime;
                log(`âŒ è¦–é »å‰ªåˆ‡å¤±æ•—: ${error.message}`);
                showResult('trimResult', `å‰ªåˆ‡å¤±æ•—: ${error.message}`, false);
                updateFFmpegStats(false, responseTime, file.size);
            }
        }

        // éŸ³é »æå–æ¸¬è©¦
        async function testAudioExtract() {
            const fileInput = document.getElementById('extractVideoFile');
            const format = document.getElementById('extractAudioFormat').value;
            const quality = document.getElementById('extractQuality').value;
            
            if (!fileInput.files[0]) {
                showResult('extractResult', 'è«‹å…ˆé¸æ“‡è¦–é »æ–‡ä»¶ï¼', false);
                return;
            }
            
            const file = fileInput.files[0];
            log(`ğŸµ é–‹å§‹éŸ³é »æå–æ¸¬è©¦: ${file.name} -> ${format}`);
            
            try {
                const startTime = Date.now();
                const formData = new FormData();
                formData.append('video', file);
                formData.append('audio_format', format);
                formData.append('quality', quality);
                
                const response = await fetch(`${BASE_URL}/api/ffmpeg/audio/extract`, {
                    method: 'POST',
                    body: formData
                });
                
                const responseTime = Date.now() - startTime;
                const result = await response.json();
                
                if (result.success) {
                    log(`âœ… éŸ³é »æå–æˆåŠŸï¼ç”¨æ™‚: ${(responseTime/1000).toFixed(2)}s`);
                    showResult('extractResult', 
                        `æå–æˆåŠŸï¼\n` +
                        `éŸ³é »æ ¼å¼: ${format}\n` +
                        `éŸ³é »è³ªé‡: ${quality}\n` +
                        `è™•ç†æ™‚é–“: ${(responseTime/1000).toFixed(2)}s\n` +
                        `æ–‡ä»¶URL: ${result.output_url}`
                    );
                    
                    await recordFFmpegResult('audio_extract', file.name, result.output_url, 
                        result.ffmpeg_command, responseTime, file.size, result.file_size, 'success');
                    updateFFmpegStats(true, responseTime, file.size);
                } else {
                    throw new Error(result.error || 'æå–å¤±æ•—');
                }
            } catch (error) {
                const responseTime = Date.now() - startTime;
                log(`âŒ éŸ³é »æå–å¤±æ•—: ${error.message}`);
                showResult('extractResult', `æå–å¤±æ•—: ${error.message}`, false);
                updateFFmpegStats(false, responseTime, file.size);
            }
        }

        // ç¸®ç•¥åœ–ç”Ÿæˆæ¸¬è©¦
        async function testThumbnailGenerate() {
            const fileInput = document.getElementById('thumbVideoFile');
            const time = document.getElementById('thumbTime').value;
            const size = document.getElementById('thumbSize').value;
            const format = document.getElementById('thumbFormat').value;
            const count = document.getElementById('thumbCount').value;
            
            if (!fileInput.files[0]) {
                showResult('thumbResult', 'è«‹å…ˆé¸æ“‡è¦–é »æ–‡ä»¶ï¼', false);
                return;
            }
            
            const file = fileInput.files[0];
            log(`ğŸ“¸ é–‹å§‹ç¸®ç•¥åœ–ç”Ÿæˆæ¸¬è©¦: ${file.name}`);
            log(`ğŸ“Š è¨­ç½®: ${count}å¼µ ${size} ${format}æ ¼å¼ @${time}`);
            
            try {
                const startTime = Date.now();
                const formData = new FormData();
                formData.append('video', file);
                formData.append('time', time);
                formData.append('size', size);
                formData.append('format', format);
                formData.append('count', count);
                
                const response = await fetch(`${BASE_URL}/api/ffmpeg/video/thumbnail`, {
                    method: 'POST',
                    body: formData
                });
                
                const responseTime = Date.now() - startTime;
                const result = await response.json();
                
                if (result.success) {
                    log(`âœ… ç¸®ç•¥åœ–ç”ŸæˆæˆåŠŸï¼ç”¨æ™‚: ${(responseTime/1000).toFixed(2)}s`);
                    log(`ğŸ–¼ï¸ ç”Ÿæˆäº† ${result.thumbnails ? result.thumbnails.length : count} å¼µç¸®ç•¥åœ–`);
                    
                    showResult('thumbResult', 
                        `ç”ŸæˆæˆåŠŸï¼\n` +
                        `ç”Ÿæˆæ•¸é‡: ${result.thumbnails ? result.thumbnails.length : count}å¼µ\n` +
                        `åœ–ç‰‡å°ºå¯¸: ${size}\n` +
                        `åœ–ç‰‡æ ¼å¼: ${format}\n` +
                        `æˆªåœ–æ™‚é–“: ${time}\n` +
                        `è™•ç†æ™‚é–“: ${(responseTime/1000).toFixed(2)}s\n` +
                        `ç¸®ç•¥åœ–URL: ${result.thumbnails ? result.thumbnails.join('\n') : result.output_url}`
                    );
                    
                    await recordFFmpegResult('thumbnail_generate', file.name, 
                        result.thumbnails ? result.thumbnails[0] : result.output_url, 
                        result.ffmpeg_command, responseTime, file.size, 0, 'success');
                    updateFFmpegStats(true, responseTime, file.size);
                } else {
                    throw new Error(result.error || 'ç”Ÿæˆå¤±æ•—');
                }
            } catch (error) {
                const responseTime = Date.now() - startTime;
                log(`âŒ ç¸®ç•¥åœ–ç”Ÿæˆå¤±æ•—: ${error.message}`);
                showResult('thumbResult', `ç”Ÿæˆå¤±æ•—: ${error.message}`, false);
                updateFFmpegStats(false, responseTime, file.size);
            }
        }

        // æª¢æŸ¥FFMPEGä¿¡æ¯
        async function checkFFmpegInfo() {
            log('â„¹ï¸ æª¢æŸ¥FFMPEGè©³ç´°ä¿¡æ¯...');
            
            try {
                const response = await fetch(`${BASE_URL}/api/ffmpeg/info`);
                const result = await response.json();
                
                if (result.success) {
                    showResult('ffmpegBatchResult', 
                        `FFMPEG ä¿¡æ¯æª¢æŸ¥ï¼š\n` +
                        `ç‰ˆæœ¬: ${result.version || 'æœªçŸ¥'}\n` +
                        `æ”¯æŒçš„ç·¨ç¢¼å™¨: ${result.codecs ? result.codecs.join(', ') : 'æœªçŸ¥'}\n` +
                        `æ”¯æŒçš„æ ¼å¼: ${result.formats ? result.formats.join(', ') : 'æœªçŸ¥'}\n` +
                        `é…ç½®é¸é …: ${result.configuration || 'æœªçŸ¥'}`
                    );
                    log(`âœ… FFMPEGä¿¡æ¯æª¢æŸ¥å®Œæˆ`);
                } else {
                    throw new Error(result.error || 'ä¿¡æ¯ç²å–å¤±æ•—');
                }
            } catch (error) {
                log(`âŒ FFMPEGä¿¡æ¯æª¢æŸ¥å¤±æ•—: ${error.message}`);
                showResult('ffmpegBatchResult', `ä¿¡æ¯æª¢æŸ¥å¤±æ•—: ${error.message}`, false);
            }
        }

        // é‹è¡ŒFFMPEGæ‰¹é‡æ¸¬è©¦
        async function runFFmpegBatchTest() {
            const task = document.getElementById('batchTask').value;
            const concurrency = parseInt(document.getElementById('batchConcurrency').value);
            const fileCount = parseInt(document.getElementById('batchFileCount').value);
            
            log(`âš¡ é–‹å§‹FFMPEGæ‰¹é‡æ¸¬è©¦: ${task} (${concurrency}ä¸¦ç™¼, ${fileCount}å€‹æ–‡ä»¶)`);
            showResult('ffmpegBatchResult', `æ­£åœ¨åŸ·è¡Œæ‰¹é‡æ¸¬è©¦ï¼Œè«‹ç¨å€™...`);
            
            // é€™è£¡å¯ä»¥å¯¦ç¾æ‰¹é‡æ¸¬è©¦é‚è¼¯
            // æ¨¡æ“¬æ‰¹é‡æ¸¬è©¦éç¨‹
            for (let i = 0; i < Math.min(5, fileCount); i++) {
                log(`ğŸ”„ è™•ç†æ¸¬è©¦æ–‡ä»¶ ${i + 1}/${fileCount}`);
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
            
            showResult('ffmpegBatchResult', 
                `æ‰¹é‡æ¸¬è©¦å®Œæˆï¼\n` +
                `ä»»å‹™é¡å‹: ${task}\n` +
                `ä¸¦ç™¼æ•¸: ${concurrency}\n` +
                `è™•ç†æ–‡ä»¶: ${fileCount}å€‹\n` +
                `ç¸½é«”æˆåŠŸç‡: ${(Math.random() * 20 + 80).toFixed(1)}%`
            );
            
            log(`âœ… FFMPEGæ‰¹é‡æ¸¬è©¦å®Œæˆ`);
        }

        // é‹è¡ŒFFMPEGå£“åŠ›æ¸¬è©¦
        async function runFFmpegStressTest() {
            log('âš¡ é–‹å§‹FFMPEGå£“åŠ›æ¸¬è©¦...');
            showResult('ffmpegBatchResult', 'æ­£åœ¨åŸ·è¡Œå£“åŠ›æ¸¬è©¦ï¼Œè«‹ç¨å€™...');
            
            const testCount = 10;
            let successCount = 0;
            
            for (let i = 0; i < testCount; i++) {
                try {
                    const response = await fetch(`${BASE_URL}/api/ffmpeg/info`);
                    if (response.ok) successCount++;
                } catch (error) {
                    log(`âŒ å£“åŠ›æ¸¬è©¦ç¬¬${i+1}æ¬¡å¤±æ•—: ${error.message}`);
                }
                await new Promise(resolve => setTimeout(resolve, 200));
            }
            
            const successRate = (successCount / testCount * 100).toFixed(1);
            showResult('ffmpegBatchResult', 
                `å£“åŠ›æ¸¬è©¦å®Œæˆï¼\n` +
                `ç¸½è«‹æ±‚æ•¸: ${testCount}\n` +
                `æˆåŠŸè«‹æ±‚: ${successCount}\n` +
                `æˆåŠŸç‡: ${successRate}%\n` +
                `æœå‹™ç©©å®šæ€§: ${successRate > 90 ? 'å„ªç§€' : successRate > 70 ? 'è‰¯å¥½' : 'éœ€è¦å„ªåŒ–'}`
            );
        }

        // æ¸…ç©ºFFMPEGæ—¥èªŒ
        function clearFFmpegLogs() {
            const logElements = ['audioConvertLog', 'videoConvertLog', 'trimLog', 'extractLog', 'thumbLog', 'ffmpegBatchLog'];
            const resultElements = ['audioConvertResult', 'videoConvertResult', 'trimResult', 'extractResult', 'thumbResult', 'ffmpegBatchResult'];
            
            [...logElements, ...resultElements].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = '';
                    element.className = element.id.includes('Log') ? 'result log' : 'result';
                }
            });
            
            log('ğŸ—‘ï¸ æ‰€æœ‰FFMPEGæ—¥èªŒå·²æ¸…ç©º');
        }
    </script>
</body>
</html>

